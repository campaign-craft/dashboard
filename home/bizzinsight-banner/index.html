<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pembuat Banner 320x480 (Canvas)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Menggunakan font Inter secara default */
        body { font-family: 'Inter', sans-serif; }
        
        /* Container untuk canvas */
        #canvas-container {
            width: 320px;
            height: 480px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
            /* Pastikan tidak ada margin/padding yang mengganggu ukuran 320x480 */
        }
        
        /* Sembunyikan div preview lama dan tampilkan canvas */
        #banner-preview-container {
            display: none; 
        }

        /* Styling untuk Canvas agar terlihat jelas */
        #banner-canvas {
            display: block;
            background-color: #f3f4f6;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-blue': '#016fba', // Warna biru baru
                    },
                }
            }
        }

        const CANVAS_WIDTH = 320;
        const CANVAS_HEIGHT = 480;
        const TEXT_COLOR = '#FFFFFF';
        // Menggunakan warna baru: #016fba
        const CTA_COLOR = '#016fba'; 
        const BLUE_BG = '#016fba';
        const PADDING_X = 20;
        const LINE_HEIGHT = 26; // Line height yang diatur manual untuk teks copy
        const CTA_BORDER_RADIUS = 15; // Radius untuk tombol CTA (agak rounded)

        let canvas;
        let ctx;
        let image = new Image();
        let currentImageURL = null; // Menyimpan URL gambar yang dimuat
        
        // --- Setup Canvas ---
        window.onload = () => {
            canvas = document.getElementById('banner-canvas');
            ctx = canvas.getContext('2d');
            canvas.width = CANVAS_WIDTH;
            canvas.height = CANVAS_HEIGHT;
            
            // Set listener untuk input teks
            document.getElementById('copy-input').addEventListener('input', drawBanner);
            
            // Panggil drawBanner untuk menampilkan state awal
            drawBanner(); 
        }
        
        /**
         * Menggambar rounded rectangle di canvas.
         */
        function roundRect(ctx, x, y, width, height, radius) {
            ctx.beginPath();
            ctx.moveTo(x + radius, y);
            ctx.lineTo(x + width - radius, y);
            ctx.arcTo(x + width, y, x + width, y + radius, radius);
            ctx.lineTo(x + width, y + height - radius);
            ctx.arcTo(x + width, y + height, x + width - radius, y + height, radius);
            ctx.lineTo(x + radius, y + height);
            ctx.arcTo(x, y + height, x, y + height - radius, radius);
            ctx.lineTo(x, y + radius);
            ctx.arcTo(x, y, x + radius, y, radius);
            ctx.closePath();
        }

        // --- Logika Gambar Banner dengan Canvas ---
        function drawBanner() {
            if (!ctx) return;
            
            // 1. Bersihkan Canvas
            ctx.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);

            // 2. Gambar Background Biru (Area Bawah)
            ctx.fillStyle = BLUE_BG;
            ctx.fillRect(0, CANVAS_HEIGHT / 2, CANVAS_WIDTH, CANVAS_HEIGHT / 2); // Mengisi setengah bawah

            // 3. Gambar Foto (Area Atas)
            if (currentImageURL) {
                // Skala gambar agar mengisi area atas 320x240 (50% tinggi)
                const imageRatio = image.width / image.height;
                let drawWidth, drawHeight, offsetX, offsetY;
                
                // Cover: Menghitung agar gambar mengisi seluruh area (crop jika perlu)
                if (imageRatio > (CANVAS_WIDTH / (CANVAS_HEIGHT / 2))) {
                    drawHeight = CANVAS_HEIGHT / 2;
                    drawWidth = drawHeight * imageRatio;
                    offsetX = (CANVAS_WIDTH - drawWidth) / 2;
                    offsetY = 0;
                } else {
                    drawWidth = CANVAS_WIDTH;
                    drawHeight = drawWidth / imageRatio;
                    offsetX = 0;
                    offsetY = (CANVAS_HEIGHT / 2 - drawHeight) / 2;
                }
                
                ctx.drawImage(image, offsetX, offsetY, drawWidth, drawHeight);
            }
            
            // 4. Gambar Gradien Overlay (Menggunakan spesifikasi CSS baru)
            const gradientHeight = CANVAS_HEIGHT; // Gradien mencakup seluruh tinggi canvas
            
            const gradient = ctx.createLinearGradient(0, 0, 0, CANVAS_HEIGHT);
            
            // Posisi 27.38% (Transparan)
            gradient.addColorStop(0.2738, 'rgba(1, 111, 186, 0.00)'); 
            
            // Posisi 47.36% (Penuh Biru)
            gradient.addColorStop(0.4736, BLUE_BG); 
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT); // Menggambar gradien di seluruh area canvas


            // 5. Gambar Teks (Copy)
            const copyText = document.getElementById('copy-input').value;
            const MAX_WIDTH = CANVAS_WIDTH - (PADDING_X * 2);
            const CTA_AREA_HEIGHT = 80; // Area dari bawah untuk CTA dan padding (50px + 30px tinggi tombol)

            ctx.fillStyle = TEXT_COLOR;
            // Mengganti 700 (Bold) menjadi 400 (Regular)
            ctx.font = '400 18px Inter'; 
            
            // Atur perataan teks menjadi CENTER
            ctx.textAlign = 'center';

            const lines = wrapText(ctx, copyText, MAX_WIDTH);
            const totalTextHeight = lines.length * LINE_HEIGHT;
            
            // Hitung Area Bebas untuk Teks
            const FREE_AREA_START = CANVAS_HEIGHT / 2;
            const FREE_AREA_HEIGHT = (CANVAS_HEIGHT / 2) - CTA_AREA_HEIGHT; 

            // Hitung posisi Y awal untuk sentering vertikal
            let currentY = FREE_AREA_START + (FREE_AREA_HEIGHT - totalTextHeight) / 2 + 20; 

            const centerX = CANVAS_WIDTH / 2; // Posisi X center

            for (let i = 0; i < lines.length; i++) {
                ctx.fillText(lines[i], centerX, currentY); // Gunakan centerX untuk center
                currentY += LINE_HEIGHT;
            }
            
            // 6. Gambar Tombol CTA (Teks dan Kotak)
            const CTA_TEXT = "BACA DISINI";
            const FONT_CTA = '700 14px Inter';
            
            // Meningkatkan padding X agar tombol lebih memanjang
            const PADDING_CTA_X_WIDE = 40; 
            const BUTTON_HEIGHT = 35; // Tinggi tombol yang sedikit diperbesar

            ctx.font = FONT_CTA;
            const textMetrics = ctx.measureText(CTA_TEXT);
            const textWidth = textMetrics.width;
            const buttonWidth = textWidth + (PADDING_CTA_X_WIDE * 2);
            
            // Posisi tombol (X center)
            const buttonX = (CANVAS_WIDTH - buttonWidth) / 2;
            
            // Posisi tombol (Y), dikunci 50px dari bawah
            const buttonY = CANVAS_HEIGHT - 50 - BUTTON_HEIGHT; 
            
            // Gambar background tombol (Kotak Putih Rounded)
            ctx.fillStyle = 'white';
            roundRect(ctx, buttonX, buttonY, buttonWidth, BUTTON_HEIGHT, CTA_BORDER_RADIUS);
            ctx.fill();
            
            // Gambar Teks CTA
            ctx.fillStyle = CTA_COLOR;
            ctx.textAlign = 'center'; 
            
            // Sentering Teks: Posisi X center tombol
            const ctaCenterX = buttonX + buttonWidth / 2;
            
            // Sentering Teks Y: Menggunakan posisi Y tombol + (tinggi tombol / 2) + (tinggi teks / 2). 
            const textY = buttonY + (BUTTON_HEIGHT / 2) + 5; // 5 adalah offset yang pas
            ctx.fillText(CTA_TEXT, ctaCenterX, textY);
            
            // Reset perataan teks ke default
            ctx.textAlign = 'left';
        }

        /**
         * Fungsi untuk membungkus teks (text wrapping) di canvas
         */
        function wrapText(ctx, text, maxWidth) {
            const words = text.split(' ');
            let lines = [];
            let currentLine = words[0];

            for (let i = 1; i < words.length; i++) {
                const word = words[i];
                const width = ctx.measureText(currentLine + " " + word).width;
                if (width < maxWidth) {
                    currentLine += " " + word;
                } else {
                    lines.push(currentLine);
                    currentLine = word;
                }
            }
            lines.push(currentLine);
            return lines;
        }

        /**
         * Mengkonversi file gambar yang diunggah menjadi URL base64 dan menampilkannya di banner.
         */
        function handleImageUpload(event) {
            const file = event.target.files[0];
            const placeholder = document.getElementById('image-placeholder'); 

            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    currentImageURL = e.target.result;
                    image.onload = () => {
                        // Sembunyikan placeholder setelah gambar dimuat
                        if (placeholder) {
                            placeholder.style.display = 'none';
                        }
                        drawBanner(); // Gambar ulang banner dengan foto baru
                    };
                    image.src = currentImageURL;
                };
                reader.readAsDataURL(file);
            } else {
                currentImageURL = null;
                image.src = '';
                if (placeholder) {
                    placeholder.style.display = 'flex';
                }
                drawBanner(); // Gambar ulang tanpa foto
            }
        }

        /**
         * Mengunduh konten canvas sebagai gambar PNG.
         */
        function downloadBanner() {
            const downloadButton = document.getElementById('download-button');
            const originalText = downloadButton.innerText;

            // Tampilkan loading state
            downloadButton.innerText = 'Mengunduh...';
            downloadButton.disabled = true;

            // Pastikan canvas sudah digambar sebelum diunduh
            drawBanner();

            try {
                // Nama default baru setelah input Nama Brand dihapus
                const safeNamePart = 'banner_canvas'; 

                // 2. Format Tanggal Hari Ini (DDMMYYYY)
                const today = new Date();
                const day = String(today.getDate()).padStart(2, '0');
                const month = String(today.getMonth() + 1).padStart(2, '0'); // Bulan dimulai dari 0
                const year = today.getFullYear();
                const dateString = day + month + year;
                
                // 3. Gabungkan untuk Nama File: 320x480_banner_canvas_DDMMYYYY.png
                const fileName = `320x480_${safeNamePart}_${dateString}.png`;

                // Unduh langsung dari canvas
                const link = document.createElement('a');
                link.href = canvas.toDataURL('image/png'); 
                link.download = fileName; // Gunakan nama file yang sudah diformat
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

            } catch (error) {
                console.error("Gagal mengunduh banner:", error);
            } finally {
                // Kembalikan tombol ke keadaan semula
                downloadButton.innerText = originalText;
                downloadButton.disabled = false;
            }
        }
    </script>
</head>
<body class="bg-gray-50 p-6 md:p-10 flex flex-col lg:flex-row gap-10 justify-center items-start lg:items-center">

    <div class="w-full lg:w-96 p-6 bg-white rounded-xl shadow-lg space-y-6">
        <div>
            <label for="photo-upload" class="block text-sm font-medium text-gray-700 mb-2">1. Unggah Foto Latar Belakang</label>
            <input 
                type="file" 
                id="photo-upload" 
                accept="image/*" 
                onchange="handleImageUpload(event)"
                class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary-blue file:text-white hover:file:bg-blue-700 rounded-lg border border-gray-300 p-2 cursor-pointer"
            >
        </div>

        <div>
            <label for="copy-input" class="block text-sm font-medium text-gray-700 mb-2">2. Teks Utama (Copy)</label>
            <textarea 
                id="copy-input" 
                rows="4" 
                oninput="drawBanner()"
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-primary-blue focus:border-primary-blue transition duration-150"
                placeholder="Technovation: Philip Morris Tegaskan Komitmen Inklusif..."
            >Technovation: Teks Utama yang Menggugah untuk Transformasi Industri.</textarea>
        </div>

        <button 
            id="download-button"
            onclick="downloadBanner()"
            class="w-full py-3 mt-4 bg-green-600 text-white font-semibold rounded-lg shadow-md hover:bg-green-700 transition duration-300 focus:outline-none focus:ring-4 focus:ring-green-500/50"
        >
            ⬇️ Unduh Banner (PNG)
        </button>
    </div>

    <div class="flex-shrink-0">
        <div id="canvas-container" class="relative">
             <div id="image-placeholder" class="absolute inset-0 flex items-center justify-center text-gray-500" style="z-index: 10; width: 320px; height: 240px; background-color: #e5e7eb;">
                <span class="text-sm">Unggah Foto di Kolom Kiri</span>
            </div>
            <canvas id="banner-canvas" width="320" height="480"></canvas>
        </div>
    </div>
</body>
</html>