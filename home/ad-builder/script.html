<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Script Ad Inspector & Builder</title>
    <link
      rel="shortcut icon"
      href="https://asset-1.tstatic.net/img/icon/tribun-icon_32.png"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap");
      @import url("https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&display=swap");

      body {
        font-family: "Inter", sans-serif;
        background-color: #f8fafc;
      }

      .code-font {
        font-family: "Fira Code", monospace;
      }

      .spinner {
        border: 3px solid rgba(0, 0, 0, 0.1);
        width: 24px;
        height: 24px;
        border-radius: 50%;
        border-left-color: #3b82f6;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      iframe.preview-standalone {
        background: white;
        transition: all 0.3s ease;
        box-shadow:
          0 4px 6px -1px rgb(0 0 0 / 0.1),
          0 2px 4px -2px rgb(0 0 0 / 0.1);
      }

      .placeholder-input:focus {
        border-color: #3b82f6;
        box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
      }
    </style>
  </head>
  <body class="p-4 md:p-8 text-slate-800">
    <div>
      <div class="max-w-7xl mx-auto">
        <header class="mb-8 text-center">
          <h1 class="text-3xl font-bold text-slate-900">
            üõ°Ô∏è Script Ad Inspector
          </h1>
          <p class="text-slate-500 mt-2 text-sm">
            Uji tag iklan pihak ketiga, petakan macro, dan simulasikan
            penayangan.
          </p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
          <div class="space-y-6">
            <div
              class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200"
            >
              <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                <span
                  class="p-2 bg-blue-100 text-blue-600 rounded-lg text-xs font-bold"
                  >1</span
                >
                Paste Ad Script
              </h2>
              <textarea
                id="scriptInput"
                class="w-full h-48 p-4 bg-slate-900 text-blue-300 code-font text-xs rounded-xl focus:ring-2 focus:ring-blue-500 outline-none resize-none border-none"
                placeholder="<ins class='dcmads' ...></ins> <script ...></script>"
                oninput="onScriptInput()"
              ></textarea>

              <div id="macroContainer" class="mt-4 space-y-3 hidden">
                <p
                  class="text-[10px] font-bold text-slate-400 uppercase tracking-widest"
                >
                  Detected Macros/Placeholders
                </p>
                <div
                  id="macroFields"
                  class="grid grid-cols-1 md:grid-cols-2 gap-3"
                ></div>
              </div>
            </div>

            <div
              class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200"
            >
              <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                <span
                  class="p-2 bg-purple-100 text-purple-600 rounded-lg text-xs font-bold"
                  >2</span
                >
                Template Settings
              </h2>
              <div class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label
                      class="block text-[10px] font-bold text-slate-500 uppercase mb-2"
                      >Pilih Format Iklan</label
                    >
                    <select
                      id="adSlotSelect"
                      onchange="updateStandaloneSize()"
                      class="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm outline-none focus:ring-2 focus:ring-blue-500"
                    >
                      <option value="">-- Pilih Format --</option>
                      <optgroup label="Desktop">
                        <option value="728x90_leaderboard">
                          Leaderboard (728x90)
                        </option>
                        <option value="970x90_leaderboard">
                          Leaderboard (970x90)
                        </option>
                        <option value="970x250">Billboard (970x250)</option>
                        <option value="300x600">Giant Banner (300x600)</option>
                        <option value="300x250_mr1">MR 1 (300x250)</option>
                        <option value="300x250_mr2">MR 2 (300x250)</option>
                        <option value="300x250_mr3">MR 3 (300x250)</option>
                        <option value="1008x60">Horizontal Ad (1008x60)</option>
                        <option value="1100x50">Horizontal Ad (1100x50)</option>
                        <option value="520x730_article_underlay">
                          Underlay (520x720)
                        </option>
                        <option value="160x600">Skyscraper (160x600)</option>
                        <option value="320x100_below_photo">
                          Below Photo (320x100)
                        </option>
                        <option value="320x100_below_article">
                          Below Article (320x100)
                        </option>
                        <option value="300x250_baloon">
                          Baloon Ads (300x250)
                        </option>
                        <option value="300x250_article_inside">
                          Inside Ads (300x250)
                        </option>
                        <option value="468x60_pickwords">
                          Pickwords (468x60)
                        </option>
                      </optgroup>
                      <optgroup label="Mobile">
                        <option value="320x50_top_mobile">
                          Top Banner (320x50)
                        </option>
                        <option value="320x100_top_mobile">
                          Top Banner (320x100)
                        </option>
                        <option value="320x150_top_mobile">
                          Top Banner (320x150)
                        </option>
                        <option value="300x250_middle_mobile">
                          Middle Banner (300x250)
                        </option>
                        <option value="320x100_below_photo_mobile">
                          Below Photo (320x100)
                        </option>
                        <option value="320x100_below_article_mobile">
                          Below Article (320x100)
                        </option>
                        <option value="320x50_horizontal_mobile">
                          Horizontal Banner (320x50)
                        </option>
                        <option value="320x100_horizontal_mobile">
                          Horizontal Banner (320x100)
                        </option>
                        <option value="640x940_underlay_mobile">
                          Underlay (640x940)
                        </option>
                        <option value="640x500_underlay_mobile">
                          Underlay (640x500)
                        </option>
                        <option value="300x250_bottom_mobile">
                          Bottom Banner (300x250)
                        </option>
                        <option value="300x250_article_inside_mobile">
                          Article Inside (300x250)
                        </option>
                        <option value="300x600_giant_mobile">
                          Giant Banner (300x600)
                        </option>
                        <option value="320x50_pickwords_mobile">
                          Pickwords Banner (320x50)
                        </option>
                        <option value="320x480_pushdown_mobile">
                          Pushdown Banner (320x480)
                        </option>
                      </optgroup>
                    </select>
                  </div>
                  <div>
                    <label
                      class="block text-[10px] font-bold text-slate-500 uppercase mb-2"
                      >Ganti Logo Daerah</label
                    >
                    <select
                      id="logoSelect"
                      class="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm outline-none"
                    >
                      <option value="default">Default (Tribunnews)</option>
                      <option value="aceh">Serambi News</option>
                      <option value="prohaba">Prohaba</option>
                      <option value="gayo">Tribun Gayo</option>
                      <option value="medan">Tribun Medan</option>
                      <option value="padang">Tribun Padang</option>
                      <option value="pekanbaru">Tribun Pekanbaru</option>
                      <option value="batam">Tribun Batam</option>
                      <option value="jambi">Tribun Jambi</option>
                      <option value="palembang">Sripoku</option>
                      <option value="bangka">Bangka Pos</option>
                      <option value="belitung">Pos Belitung</option>
                      <option value="bengkulu">Tribun Bengkulu</option>
                      <option value="lampung">Tribun Lampung</option>
                      <option value="sumsel">Tribun Sumsel</option>
                      <option value="jakarta">Tribun Jakarta</option>
                      <option value="wartakota">Warta Kota</option>
                      <option value="banten">Tribun Banten</option>
                      <option value="tangerang">Tribun Tangerang</option>
                      <option value="jabar">Tribun Jabar</option>
                      <option value="depok">Tribun Depok</option>
                      <option value="bekasi">Tribun Bekasi</option>
                      <option value="bogor">Tribunnews Bogor</option>
                      <option value="priangan">Tribun Priangan</option>
                      <option value="cirebon">Tribun Cirebon</option>
                      <option value="jateng">Tribun Jateng</option>
                      <option value="solo">Tribun Solo</option>
                      <option value="banyumas">Tribun Banyumas</option>
                      <option value="mataraman">Tribun Mataraman</option>
                      <option value="jatim">Tribun Jatim</option>
                      <option value="surabaya">Surya</option>
                      <option value="suryamalang">Surya Malang</option>
                      <option value="madura">Tribun Madura</option>
                      <option value="jogja">Tribun Jogja</option>
                      <option value="bali">Tribun Bali</option>
                      <option value="pontianak">Tribun Pontianak</option>
                      <option value="kalteng">Tribun Kalteng</option>
                      <option value="kaltim">Tribun Kaltim</option>
                      <option value="kaltara">Tribun Kaltara</option>
                      <option value="banjarmasin">Banjarmasin Post</option>
                      <option value="sulbar">Tribun Sulbar</option>
                      <option value="makassar">Tribun Timur</option>
                      <option value="toraja">Tribun Toraja</option>
                      <option value="sultra">Tribun Sultra</option>
                      <option value="palu">Tribun Palu</option>
                      <option value="manado">Tribun Manado</option>
                      <option value="gorontalo">Tribun Gorontalo</option>
                      <option value="lombok">Tribun Lombok</option>
                      <option value="kupang">Pos Kupang</option>
                      <option value="flores">Tribun Flores</option>
                      <option value="ternate">Tribun Ternate</option>
                      <option value="ambon">Tribun Ambon</option>
                      <option value="papua">Tribun Papua</option>
                      <option value="papuabarat">Tribun Papua Barat</option>
                      <option value="sorong">Tribun Sorong</option>
                      <option value="papuatengah">Tribun Papua Tengah</option>
                    </select>
                  </div>
                </div>
                <div class="flex gap-3">
                  <button
                    id="generateBtn"
                    disabled
                    onclick="generateTemplate()"
                    class="flex-[2] bg-blue-600 text-white font-bold py-3 rounded-xl shadow-lg hover:bg-blue-700 disabled:bg-slate-300 transition-all"
                  >
                    üöÄ Preview di Website
                  </button>
                  <button
                    id="downloadBtn"
                    disabled
                    onclick="downloadHtml()"
                    class="flex-1 bg-slate-800 text-white font-bold py-3 rounded-xl hover:bg-slate-900 disabled:bg-slate-200 transition-all"
                  >
                    üíæ Download HTML
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div
            id="inspectorPanel"
            class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 flex flex-col"
          >
            <div class="flex items-center justify-between mb-6">
              <div>
                <h2 class="text-lg font-semibold flex items-center gap-2">
                  üîç Script Standalone Preview
                </h2>
                <p class="text-xs text-slate-400">
                  Hasil eksekusi script murni
                </p>
              </div>
              <button
                onclick="reloadStandalone()"
                class="p-2 bg-slate-50 hover:bg-slate-100 rounded-lg text-slate-500 border border-slate-200"
              >
                üîÑ
              </button>
            </div>
            <div
              id="standaloneContainer"
              class="flex-1 bg-slate-50 rounded-2xl overflow-auto flex items-center justify-center min-h-[400px] border-4 border-dashed border-slate-200 p-8"
            >
              <div class="text-center text-slate-400">
                <div class="text-5xl mb-4">üìú</div>
                <p class="text-sm italic">Tempel script untuk melihat hasil</p>
              </div>
            </div>
            <div id="standaloneSizeBadge" class="mt-4 text-center hidden">
              <span
                class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-[10px] font-bold uppercase tracking-widest"
                id="activeSizeBadge"
              ></span>
            </div>
          </div>
        </div>
      </div>

      <div
        class="bg-white max-w-full p-6 rounded-2xl shadow-sm border border-slate-200"
      >
        <h2 class="text-xl font-bold text-slate-800 mb-6">
          üìã Website Context Preview
        </h2>
        <div
          id="iframeWrapper"
          class="relative bg-slate-100 rounded-xl overflow-hidden min-h-[600px] border border-slate-100 flex justify-center p-4"
        >
          <iframe
            id="mainPreview"
            class="bg-white shadow-2xl hidden transition-all duration-500 origin-top"
          ></iframe>
          <div
            id="placeholderPreview"
            class="flex flex-col items-center justify-center p-20 text-center opacity-40"
          >
            <div class="text-7xl mb-6">üåê</div>
            <p class="text-slate-500 max-w-md">
              Klik "Preview di Website" untuk simulasi tampilan pada artikel
              berita.
            </p>
          </div>
        </div>
      </div>
    </div>

    <script>
      const adSlots = {
        "728x90_leaderboard": {
          name: "Leaderboard 1",
          width: 728,
          height: 90,
          template: "DESKTOP/template_leaderboard_728x90.html",
        },
        "970x90_leaderboard": {
          name: "Leaderboard 2",
          width: 970,
          height: 90,
          template: "DESKTOP/template_leaderboard_970x90.html",
        },
        "970x250": {
          name: "Billboard",
          width: 970,
          height: 250,
          template: "DESKTOP/template_billboard.html",
        },
        "300x600": {
          name: "Giant Banner",
          width: 300,
          height: 600,
          template: "DESKTOP/template_giant_banner_desktop.html",
        },
        "300x250_mr1": {
          name: "MR 1",
          width: 300,
          height: 250,
          template: "DESKTOP/template_mr1.html",
        },
        "300x250_mr2": {
          name: "MR 2",
          width: 300,
          height: 250,
          template: "DESKTOP/template_mr2.html",
        },
        "300x250_mr3": {
          name: "MR 3",
          width: 300,
          height: 250,
          template: "DESKTOP/template_mr3.html",
        },
        "1008x60": {
          name: "Horizontal Ad",
          width: 1008,
          height: 60,
          template: "DESKTOP/template_horizontal_ad_desktop_1008x60.html",
        },
        "1100x50": {
          name: "Horizontal Ad",
          width: 1100,
          height: 50,
          template: "DESKTOP/template_horizontal_ad_desktop_1100x50.html",
        },
        "120x600": {
          name: "Skin Ad",
          width: 120,
          height: 600,
          template: "DESKTOP/template_skin_ad.html",
        },
        "160x600": {
          name: "Skyscraper",
          width: 160,
          height: 600,
          template: "DESKTOP/template_skyscraper.html",
        },
        "300x250_baloon": {
          name: "Baloon Ads",
          width: 300,
          height: 250,
          template: "DESKTOP/template_baloon_ads.html",
        },
        "520x730_article_underlay": {
          name: "Article Underlay",
          width: 520,
          height: 730,
          template: "DESKTOP/template_article_underlay_ad.html",
        },
        "300x250_article_inside": {
          name: "Article Inside",
          width: 300,
          height: 250,
          template: "DESKTOP/template_article_inside_ad.html",
        },
        "320x100_below_photo": {
          name: "Below Photo",
          width: 320,
          height: 100,
          template: "DESKTOP/template_below_photo.html",
        },
        "320x100_below_article": {
          name: "Below Article",
          width: 320,
          height: 100,
          template: "DESKTOP/template_below_article.html",
        },
        "468x60_pickwords": {
          name: "Pickwords",
          width: 468,
          height: 60,
          template: "DESKTOP/template_pickwords.html",
        },
        "320x50_top_mobile": {
          name: "Top Banner Mobile 50",
          width: 320,
          height: 50,
          template: "MOBILE/template_top_banner_mobile_320x50.html",
        },
        "320x100_top_mobile": {
          name: "Top Banner Mobile 100",
          width: 320,
          height: 100,
          template: "MOBILE/template_top_banner_mobile_320x100.html",
        },
        "320x150_top_mobile": {
          name: "Top Banner Mobile 150",
          width: 320,
          height: 150,
          template: "MOBILE/template_top_banner_mobile_320x150.html",
        },
        "300x250_middle_mobile": {
          name: "Middle Banner Mobile",
          width: 300,
          height: 250,
          template: "MOBILE/template_middle_banner_mobile.html",
        },
        "320x100_below_photo_mobile": {
          name: "Below Photo Mobile",
          width: 320,
          height: 100,
          template: "MOBILE/template_below_photo_mobile.html",
        },
        "320x100_below_article_mobile": {
          name: "Below Article Mobile",
          width: 320,
          height: 100,
          template: "MOBILE/template_below_article_mobile.html",
        },
        "320x50_horizontal_mobile": {
          name: "Horizontal Mobile",
          width: 320,
          height: 50,
          template: "MOBILE/template_horizontal_mobile_320x50.html",
        },
        "320x100_horizontal_mobile": {
          name: "Horizontal Mobile",
          width: 320,
          height: 100,
          template: "MOBILE/template_horizontal_mobile_320x100.html",
        },
        "640x940_underlay_mobile": {
          name: "Underlay Mobile",
          width: 640,
          height: 940,
          template: "MOBILE/template_underlay_mobile_640x940.html",
        },
        "640x500_underlay_mobile": {
          name: "Underlay Mobile",
          width: 640,
          height: 500,
          template: "MOBILE/template_underlay_mobile_640x500.html",
        },
        "300x250_bottom_mobile": {
          name: "Bottom Banner Mobile",
          width: 300,
          height: 250,
          template: "MOBILE/template_bottom_banner_mobile.html",
        },
        "300x250_article_inside_mobile": {
          name: "Article Inside Mobile",
          width: 300,
          height: 250,
          template: "MOBILE/template_article_inside_mobile.html",
        },
        "300x600_giant_mobile": {
          name: "Giant Banner Mobile",
          width: 300,
          height: 600,
          template: "MOBILE/template_giant_mobile.html",
        },
        "320x50_pickwords_mobile": {
          name: "Pickwords Mobile",
          width: 320,
          height: 50,
          template: "MOBILE/template_pickwords_mobile.html",
        },
        "320x480_pushdown_mobile": {
          name: "Pushdown Mobile",
          width: 320,
          height: 480,
          template: "MOBILE/template_pushdown_mobile.html",
        },
      };

      const logoUrls = {
        default:
          "https://asset-1.tstatic.net/img/logo/tribun/svg/tribunnews.svg",
        aceh: "https://asset-1.tstatic.net/img/logo/daerah/svg3/serambiindonesia.svg",
        prohaba: "https://asset-1.tstatic.net/img/logo/daerah/svg3/prohaba.svg",
        gayo: "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribungayo.svg",
        medan:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunmedan.svg",
        padang:
          "https://asset-1.tribunnews.com/img/logo/tribun/svg/TribunPadang.svg",
        pekanbaru:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunpekanbaru.svg",
        batam:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunbatam.svg",
        jambi:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunjambi.svg",
        palembang:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/sriwijayapost.svg",
        bangka:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/bangkapos.svg",
        belitung:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/posbelitung.svg",
        bengkulu:
          "https://asset-1.tribunnews.com/img/logo/daerah/svg3/Tribunbengkulu.svg",
        lampung:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunlampung.svg",
        sumsel:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunsumsel.svg",
        jakarta:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunjakarta.svg",
        wartakota:
          "https://asset-1.tribunnews.com/img/logo/daerah/svg3/wartakotalive.svg",
        banten:
          "https://asset-1.tstatic.net/img/logo/tribun/svg/tribunbanten2.svg",
        tangerang:
          "https://asset-1.tribunnews.com/img/logo/daerah/svg3/TribunTangerang.svg",
        jabar:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunjabar5.svg",
        depok:
          "https://asset-1.tribunnews.com/img/logo/daerah/svg3/tribunnewsdepok.svg",
        bekasi:
          "https://asset-1.tribunnews.com/img/logo/daerah/svg3/Tribunbekasi.svg",
        bogor:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunnewsbogor.svg",
        priangan:
          "https://asset-1.tribunnews.com/img/logo/daerah/svg3/TribunPriangan.svg",
        cirebon:
          "https://asset-1.tribunnews.com/img/logo/tribun/svg/TribunCirebon.svg",
        jateng:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunjateng.svg",
        solo: "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunsolo.svg",
        banyumas:
          "https://asset-1.tribunnews.com/img/logo/daerah/svg3/tribunbanyumas3.svg",
        mataraman:
          "https://asset-1.tribunnews.com/img/logo/daerah/svg3/tribunMataraman.svg",
        jatim:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunjatim.svg",
        surabaya: "https://asset-1.tstatic.net/img/logo/daerah/svg3/surya.svg",
        suryamalang:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/suryamalang.svg",
        madura:
          "https://asset-1.tribunnews.com/img/logo/tribun/svg/TribunMadura.svg",
        jogja:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunjogja.svg",
        bali: "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunbali.svg",
        pontianak:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunpontianak.svg",
        kalteng:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunkalteng.svg",
        kaltim:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunkaltim.svg",
        kaltara:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunkaltara.svg",
        banjarmasin:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/banjarmasinpost.svg",
        sulbar:
          "https://asset-1.tribunnews.com/img/logo/daerah/sulbar/tribun-sulbar.com.png",
        makassar:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribuntimur.svg",
        toraja:
          "https://asset-1.tribunnews.com/img/logo/daerah/svg3/TribunToraja.svg",
        sultra:
          "https://asset-1.tribunnews.com/img/logo/daerah/svg3/tribunnewssultra.svg",
        palu: "https://asset-1.tribunnews.com/img/logo/daerah/svg3/Tribun_Palu.svg",
        manado:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunmanado.svg",
        gorontalo:
          "https://asset-1.tribunnews.com/img/logo/daerah/svg3/TribunGorontalo.svg",
        lombok:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunlombok.svg",
        kupang:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/poskupang.svg",
        flores:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunflores.svg",
        ternate:
          "https://asset-1.tribunnews.com/img/logo/tribun/svg/TribunTernate.svg",
        ambon:
          "https://asset-1.tribunnews.com/img/logo/tribun/svg/TribunAmbon.svg",
        papua:
          "https://asset-1.tribunnews.com/img/logo/tribun/svg/TribunPapua.svg",
        papuabarat:
          "https://asset-1.tribunnews.com/img/logo/daerah/svg3/TribunPapuaBarat.svg",
        sorong:
          "https://asset-1.tribunnews.com/img/logo/daerah/svg3/TribunSorong.svg",
        papuatengah:
          "https://asset-1.tribunnews.com/img/logo/daerah/svg3/TribunPapuaTengah.svg",
      };

      let macroList = [];

      function onScriptInput() {
        const input = document.getElementById("scriptInput").value;
        detectMacros(input);
        detectDimensions(input);
        renderStandalone();
        checkGenerateState();
      }

      function detectMacros(text) {
        const regex = /\[([A-Z0-9_]+)\]|\$\{([A-Z0-9_]+)\}|%%([A-Z0-9_]+)%%/g;
        let match;
        const foundMacros = new Set();
        while ((match = regex.exec(text)) !== null) {
          foundMacros.add(match[1] || match[2] || match[3]);
        }

        const container = document.getElementById("macroContainer");
        const fields = document.getElementById("macroFields");

        if (foundMacros.size > 0) {
          container.classList.remove("hidden");
          const newList = Array.from(foundMacros);
          if (JSON.stringify(newList) !== JSON.stringify(macroList)) {
            macroList = newList;
            fields.innerHTML = "";
            macroList.forEach((macro) => {
              const div = document.createElement("div");
              div.innerHTML = `<label class="block text-[9px] font-bold text-slate-400 uppercase mb-1">${macro}</label>
                               <input type="text" data-macro="${macro}" oninput="renderStandalone()" class="placeholder-input w-full p-2 bg-slate-50 border border-slate-200 rounded-lg text-xs outline-none transition-all" placeholder="Value for ${macro}">`;
              fields.appendChild(div);
            });
          }
        } else {
          container.classList.add("hidden");
          macroList = [];
        }
      }

      function detectDimensions(text) {
        const wMatch = text.match(/width[:='"]\s*(\d+)/i);
        const hMatch = text.match(/height[:='"]\s*(\d+)/i);
        if (wMatch && hMatch) {
          const sizeStr = `${wMatch[1]}x${hMatch[2]}`;
          const select = document.getElementById("adSlotSelect");
          for (let option of select.options) {
            if (option.value.includes(sizeStr)) {
              select.value = option.value;
              updateStandaloneSize();
              break;
            }
          }
        }
      }

      function getProcessedScript() {
        let script = document.getElementById("scriptInput").value;
        const inputs = document.querySelectorAll("#macroFields input");
        inputs.forEach((input) => {
          const macro = input.getAttribute("data-macro");
          const val = input.value || `[${macro}]`;
          script = script
            .split(`[${macro}]`)
            .join(val)
            .split(`\${${macro}}`)
            .join(val)
            .split(`%%${macro}%%`)
            .join(val);
        });
        return script;
      }

      function renderStandalone() {
        const script = getProcessedScript();
        if (!script.trim()) return;
        const container = document.getElementById("standaloneContainer");

        const htmlOpen = "<" + "html" + ">";
        const htmlClose = "<" + "/html" + ">";
        const bodyOpen = "<" + "body" + ">";
        const bodyClose = "<" + "/body" + ">";

        const content = `<!DOCTYPE html>
${htmlOpen}
<head>
  <style>
    body { margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
  </style>
</head>
${bodyOpen}
  ${script}
${bodyClose}
${htmlClose}`;

        container.innerHTML = `<iframe id="standaloneIframe" 
                class="preview-standalone border-none bg-white" 
                style="width: 320px; height: 50px;"
                allow="autoplay; fullscreen"
                sandbox="allow-forms allow-modals allow-popups allow-popups-to-escape-sandbox allow-scripts allow-same-origin">
        </iframe>`;

        const ifr = document.getElementById("standaloneIframe");
        if (ifr) {
          ifr.srcdoc = content;
        }

        updateStandaloneSize();
      }

      function updateStandaloneSize() {
        const slotId = document.getElementById("adSlotSelect").value;
        const ifr = document.getElementById("standaloneIframe");
        const badge = document.getElementById("activeSizeBadge");
        const info = document.getElementById("standaloneSizeBadge");
        if (!ifr) return;
        if (slotId && adSlots[slotId]) {
          ifr.style.width = adSlots[slotId].width + "px";
          ifr.style.height = adSlots[slotId].height + "px";
          badge.textContent = `${adSlots[slotId].width} x ${adSlots[slotId].height}`;
          info.classList.remove("hidden");
        } else {
          info.classList.add("hidden");
        }
        checkGenerateState();
      }

      function checkGenerateState() {
        const script = document.getElementById("scriptInput").value;
        const slot = document.getElementById("adSlotSelect").value;
        document.getElementById("generateBtn").disabled = !(
          script.trim() && slot
        );
      }

      function reloadStandalone() {
        renderStandalone();
      }

      function downloadHtml() {
        const mainPreview = document.getElementById("mainPreview");
        const slotId = document.getElementById("adSlotSelect").value;
        const html = mainPreview.contentDocument.documentElement.outerHTML;
        const blob = new Blob([html], { type: "text/html" });
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = `script_ad_${slotId}.html`;
        a.click();
      }

      async function generateTemplate() {
        const slotId = document.getElementById("adSlotSelect").value;
        const slot = adSlots[slotId];
        const logoKey = document.getElementById("logoSelect").value;
        const script = getProcessedScript();
        const mainPreview = document.getElementById("mainPreview");
        const placeholder = document.getElementById("placeholderPreview");

        if (!slot) return;
        mainPreview.classList.add("hidden");
        placeholder.innerHTML = `<div class="spinner"></div><p class="mt-4 text-slate-500 font-medium text-sm">Executing script tags...</p>`;
        placeholder.classList.remove("hidden");

        try {
          const response = await fetch(slot.template);
          if (!response.ok) throw new Error("Template not found");
          let html = await response.text();
          html = html.replace(
            /https:\/\/asset-1\.tstatic\.net\/img\/logo\/tribun\/svg\/tribunnews\.svg/g,
            logoUrls[logoKey],
          );

          const parser = new DOMParser();
          const doc = parser.parseFromString(html, "text/html");
          doc
            .querySelectorAll(".ad-slot")
            .forEach(
              (div) =>
                (div.innerHTML = `<div style="display:flex;justify-content:center;align-items:center;width:100%;height:100%;">${script}</div>`),
            );

          mainPreview.contentDocument.open();
          mainPreview.contentDocument.write(doc.documentElement.outerHTML);
          mainPreview.contentDocument.close();

          mainPreview.style.width = ["320x", "_mobile", "300x200"].some((k) =>
            slotId.includes(k),
          )
            ? "400px"
            : "100%";
          mainPreview.classList.remove("hidden");
          placeholder.classList.add("hidden");
          document.getElementById("downloadBtn").disabled = false;
        } catch (err) {
          alert("Error: " + err.message);
          placeholder.classList.add("hidden");
        }
      }

      checkGenerateState();
    </script>
  </body>
</html>
