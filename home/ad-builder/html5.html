<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HTML5 Ad Inspector & Builder</title>
    <link
      rel="shortcut icon"
      href="https://asset-1.tstatic.net/img/icon/tribun-icon_32.png"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap");

      body {
        font-family: "Inter", sans-serif;
        background-color: #f1f5f9;
      }

      .custom-scrollbar::-webkit-scrollbar {
        width: 6px;
      }
      .custom-scrollbar::-webkit-scrollbar-track {
        background: #f1f5f9;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 10px;
      }

      .drop-zone--over {
        border-color: #3b82f6;
        background-color: #eff6ff;
      }

      .spinner {
        border: 3px solid rgba(0, 0, 0, 0.1);
        width: 24px;
        height: 24px;
        border-radius: 50%;
        border-left-color: #3b82f6;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      iframe.preview-standalone {
        background: white;
        transition: all 0.3s ease;
        box-shadow:
          0 10px 25px -5px rgba(0, 0, 0, 0.1),
          0 8px 10px -6px rgba(0, 0, 0, 0.1);
      }

      .show-border {
        outline: 1px solid #e2e8f0;
      }
    </style>
  </head>
  <body class="p-4 md:p-8">
    <div>

      <div class="max-w-7xl mx-auto">
      <header class="mb-8 text-center">
        <h1 class="text-3xl font-bold text-slate-800">üéØ HTML5 Ad Inspector</h1>
        <p class="text-slate-500 mt-2">
          Periksa aset, audit ukuran, dan simulasikan iklan HTML5 dalam
          template.
        </p>
      </header>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
        <div class="space-y-6">
          <div
            class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200"
          >
            <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
              <span class="p-2 bg-blue-100 text-blue-600 rounded-lg text-sm"
                >1</span
              >
              Upload HTML5 ZIP
            </h2>
            <div
              id="dropZone"
              class="border-2 border-dashed border-slate-300 rounded-xl p-6 text-center hover:border-blue-500 transition-colors cursor-pointer relative"
            >
              <input
                type="file"
                id="zipInput"
                class="absolute inset-0 opacity-0 cursor-pointer"
                accept=".zip"
              />
              <div class="text-slate-400 text-3xl mb-2">üì¶</div>
              <p class="text-sm font-medium text-slate-600">
                Klik atau drag file ZIP di sini
              </p>
            </div>
            <div id="zipStatus" class="mt-4 hidden">
              <div
                class="flex items-center gap-3 p-3 bg-slate-50 rounded-lg border border-slate-100"
              >
                <div id="zipIcon" class="text-xl">üìÑ</div>
                <div class="flex-1 overflow-hidden">
                  <p
                    id="zipName"
                    class="text-sm font-bold truncate text-slate-700"
                  ></p>
                  <p id="zipSize" class="text-xs text-slate-500"></p>
                </div>
                <div
                  id="zipBadge"
                  class="px-2 py-1 rounded text-[10px] font-bold uppercase"
                ></div>
              </div>
            </div>
          </div>

          <div
            class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200"
          >
            <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
              <span class="p-2 bg-purple-100 text-purple-600 rounded-lg text-sm"
                >2</span
              >
              Template & Branding
            </h2>
            <div class="space-y-4">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label
                    class="block text-[10px] font-bold text-slate-500 uppercase mb-2"
                    >Pilih Format Iklan</label
                  >
                  <select
                    id="adSlotSelect"
                    onchange="onSlotChange()"
                    class="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm outline-none focus:ring-2 focus:ring-blue-500"
                  >
                    <option value="">-- Pilih Format --</option>
                      <optgroup label="Desktop">
                      <option value="728x90_leaderboard">
                        Leaderboard (728x90)
                      </option>
                      <option value="970x90_leaderboard">
                        Leaderboard (970x90)
                      </option>
                      <option value="970x250">Billboard (970x250)</option>
                      <option value="300x600">Giant Banner (300x600)</option>
                      <option value="300x250_mr1">MR 1 (300x250)</option>
                      <option value="300x250_mr2">MR 2 (300x250)</option>
                      <option value="300x250_mr3">MR 3 (300x250)</option>
                      <option value="1008x60">Horizontal Ad (1008x60)</option>
                      <option value="1100x50">Horizontal Ad (1100x50)</option>
                      <option value="520x730_article_underlay">
                        Underlay (520x720)
                      </option>
                      <option value="160x600">Skyscraper (160x600)</option>
                      <option value="320x100_below_photo">
                        Below Photo (320x100)
                      </option>
                      <option value="320x100_below_article">
                        Below Article (320x100)
                      </option>
                      <option value="300x250_baloon">
                        Baloon Ads (300x250)
                      </option>
                      <option value="300x250_article_inside">
                        Inside Ads (300x250)
                      </option>
                      <option value="468x60_pickwords">
                        Pickwords (468x60)
                      </option>
                    </optgroup>

                    <optgroup label="Mobile">
                      <option value="320x50_top_mobile">
                        Top Banner (320x50)
                      </option>
                      <option value="320x100_top_mobile">
                        Top Banner (320x100)
                      </option>
                      <option value="320x150_top_mobile">
                        Top Banner (320x150)
                      </option>
                      <option value="300x250_middle_mobile">
                        Middle Banner (300x250)
                      </option>
                      <option value="320x100_below_photo_mobile">
                        Below Photo (320x100)
                      </option>
                      <option value="320x100_below_article_mobile">
                        Below Article (320x100)
                      </option>
                       <option value="320x50_horizontal_mobile">
                        Horizontal Banner (320x50)
                      </option>
                      <option value="320x100_horizontal_mobile">
                        Horizontal Banner (320x100)
                      </option>
                      <option value="640x940_underlay_mobile">
                        Underlay (640x940)
                      </option>
                      <option value="640x500_underlay_mobile">
                        Underlay (640x500)
                      </option>  </option>
                      <option value="300x250_bottom_mobile">
                        Bottom Banner (300x250)
                      </option>
                      <option value="300x250_article_inside_mobile">
                        Article Inside (300x250)                    
                      <option value="300x600_giant_mobile">
                        Giant Banner (300x600)
                      </option>
                      <option value="320x50_pickwords_mobile">
                        Pickwords Banner (320x50)
                      </option>
                         <option value="320x480_pushdown_mobile">
                          Pushdown Banner (320x480)
                        </option>

                    
                     
                    </optgroup>
                  </select>
                </div>
                <div>
                  <label
                    class="block text-[10px] font-bold text-slate-500 uppercase mb-2"
                    >Ganti Logo Daerah</label
                  >
               <select
                  id="logoSelect"
                  class="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm outline-none"
                >
                  <option value="default">Default (Tribunnews)</option>
                  <option value="aceh">Serambi News</option>
                  <option value="prohaba">Prohaba</option>
                  <option value="gayo">Tribun Gayo</option>
                  <option value="medan">Tribun Medan</option>
                  <option value="padang">Tribun Padang</option>
                  <option value="pekanbaru">Tribun Pekanbaru</option>
                  <option value="batam">Tribun Batam</option>
                  <option value="jambi">Tribun Jambi</option>
                  <option value="palembang">Sripoku</option>
                  <option value="bangka">Bangka Pos</option>
                  <option value="belitung">Pos Belitung</option>
                  <option value="bengkulu">Tribun Bengkulu</option>
                  <option value="lampung">Tribun Lampung</option>
                  <option value="sumsel">Tribun Sumsel</option>
                  <option value="jakarta">Tribun Jakarta</option>
                  <option value="wartakota">Warta Kota</option>
                  <option value="banten">Tribun Banten</option>
                  <option value="tangerang">Tribun Tangerang</option>
                  <option value="jabar">Tribun Jabar</option>
                  <option value="depok">Tribun Depok</option>
                  <option value="bekasi">Tribun Bekasi</option>
                  <option value="bogor">Tribunnews Bogor</option>
                  <option value="priangan">Tribun Priangan</option>
                  <option value="cirebon">Tribun Cirebon</option>
                  <option value="jateng">Tribun Jateng</option>
                  <option value="solo">Tribun Solo</option>
                  <option value="banyumas">Tribun Banyumas</option>
                  <option value="mataraman">Tribun Mataraman</option>
                  <option value="jatim">Tribun Jatim</option>
                  <option value="surabaya">Surya</option>
                  <option value="suryamalang">Surya Malang</option>
                  <option value="madura">Tribun Madura</option>
                  <option value="jogja">Tribun Jogja</option>
                  <option value="bali">Tribun Bali</option>
                  <option value="pontianak">Tribun Pontianak</option>
                  <option value="kalteng">Tribun Kalteng</option>
                  <option value="kaltim">Tribun Kaltim</option>
                  <option value="kaltara">Tribun Kaltara</option>
                  <option value="banjarmasin">Banjarmasin Post</option>
                  <option value="sulbar">Tribun Sulbar</option>
                  <option value="makassar">Tribun Timur</option>
                  <option value="toraja">Tribun Toraja</option>
                  <option value="sultra">Tribun Sultra</option>
                  <option value="palu">Tribun Palu</option>
                  <option value="manado">Tribun Manado</option>
                  <option value="gorontalo">Tribun Gorontalo</option>
                  <option value="lombok">Tribun Lombok</option>
                  <option value="kupang">Pos Kupang</option>
                  <option value="flores">Tribun Flores</option>
                  <option value="ternate">Tribun Ternate</option>
                  <option value="ambon">Tribun Ambon</option>
                  <option value="papua">Tribun Papua</option>
                  <option value="papuabarat">Tribun Papua Barat</option>
                  <option value="sorong">Tribun Sorong</option>
                  <option value="papuatengah">Tribun Papua Tengah</option>
                </select>
                </div>
              </div>
              <div>
                <label
                  class="block text-[10px] font-bold text-slate-500 uppercase mb-2"
                  >Landing Page URL</label
                >
                <input
                  type="text"
                  id="lpInput"
                  placeholder="https://example.com"
                  class="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm outline-none"
                />
              </div>
              <div class="flex gap-3">
                <button
                  id="generateBtn"
                  disabled
                  onclick="generateTemplate()"
                  class="flex-[2] bg-blue-600 text-white font-bold py-3 rounded-xl shadow-lg shadow-blue-200 hover:bg-blue-700 disabled:bg-slate-300 disabled:shadow-none transition-all"
                >
                  üöÄ Preview di Website
                </button>
                <button
                  id="downloadBtn"
                  disabled
                  onclick="downloadBundle()"
                  class="flex-1 bg-slate-800 text-white font-bold py-3 rounded-xl hover:bg-slate-900 disabled:bg-slate-200 transition-all"
                  title="Download Bundel"
                >
                  üíæ Download
                </button>
              </div>
            </div>
          </div>

          <div
            id="auditSection"
            class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 opacity-50 pointer-events-none transition-opacity"
          >
            <h2
              class="text-sm font-semibold mb-4 text-slate-500 uppercase tracking-wider"
            >
              üì¶ File Audit
            </h2>
            <div class="grid grid-cols-2 gap-4 mb-4">
              <div
                class="p-3 bg-slate-50 rounded-lg border border-slate-100 text-center"
              >
                <p class="text-[10px] text-slate-400 uppercase font-bold">
                  Files
                </p>
                <p id="totalFiles" class="text-lg font-bold text-slate-700">
                  -
                </p>
              </div>
              <div
                class="p-3 bg-slate-50 rounded-lg border border-slate-100 text-center"
              >
                <p class="text-[10px] text-slate-400 uppercase font-bold">
                  Main Load
                </p>
                <p id="mainLoadSize" class="text-lg font-bold text-slate-700">
                  -
                </p>
              </div>
            </div>
            <div
              class="max-h-32 overflow-y-auto custom-scrollbar border border-slate-100 rounded-lg"
            >
              <table class="w-full text-left text-[11px]">
                <tbody
                  id="fileListTable"
                  class="divide-y divide-slate-100"
                ></tbody>
              </table>
            </div>
          </div>
        </div>

        <div
          id="inspectorPanel"
          class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 flex flex-col"
        >
          <div class="flex items-center justify-between mb-6">
            <div>
              <h2 class="text-lg font-semibold flex items-center gap-2">
                üîç Materi Inspector
              </h2>
              <p class="text-xs text-slate-400">
                Standalone preview materi asli
              </p>
            </div>
            <div class="flex gap-2">
              <button
                onclick="reloadStandalone()"
                class="p-2 bg-slate-50 hover:bg-slate-100 rounded-lg text-slate-500 border border-slate-200"
                title="Replay Animation"
              >
                üîÑ
              </button>
              <button
                onclick="togglePreviewBorder()"
                class="p-2 bg-slate-50 hover:bg-slate-100 rounded-lg text-slate-500 border border-slate-200"
                title="Toggle Border"
              >
                üî≤
              </button>
            </div>
          </div>

          <div
            id="standaloneContainer"
            class="flex-1 bg-slate-100 rounded-2xl overflow-auto flex items-center justify-center min-h-[400px] border-4 border-dashed border-slate-200 p-8"
          >
            <div class="text-center text-slate-400">
              <div class="text-5xl mb-4">‚ú®</div>
              <p class="text-sm italic">Unggah ZIP untuk melihat materi</p>
            </div>
          </div>

          <div id="standaloneDimensionsInfo" class="mt-4 text-center hidden">
            <span
              class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-[10px] font-bold uppercase tracking-widest"
              id="activeSizeBadge"
              >300 x 250</span
            >
          </div>
        </div>
      </div>

      </div>

      <div class="bg-white max-w-full p-6 rounded-2xl shadow-sm border border-slate-200">
        <div
          class="flex items-center justify-between mb-6 border-b border-slate-100 pb-4"
        >
          <h2 class="text-xl font-bold text-slate-800 flex items-center gap-2">
            üìã Website Context Preview
          </h2>
          <div
            id="responsiveBadge"
            class="hidden px-3 py-1 bg-slate-100 text-slate-600 rounded-lg text-xs font-medium"
          >
            Mode: <span id="modeName">Desktop</span>
          </div>
        </div>

        <div
          id="iframeWrapper"
          class="relative bg-slate-50 rounded-xl overflow-hidden min-h-[600px] border border-slate-100 flex justify-center p-4"
        >
          <iframe
            id="mainPreview"
            class="bg-white shadow-2xl hidden transition-all duration-500 origin-top"
          ></iframe>

          <div
            id="placeholderPreview"
            class="flex flex-col items-center justify-center p-20 text-center opacity-40"
          >
            <div class="text-7xl mb-6">üåê</div>
            <h3 class="text-xl font-semibold text-slate-700 mb-2">
              Simulasi Konteks Website
            </h3>
            <p class="text-slate-500 max-w-md">
              Setelah mengunggah materi, pilih format iklan dan klik tombol
              "Preview di Website" untuk melihat tampilan iklan di antara konten
              artikel.
            </p>
          </div>
        </div>
      </div>
    </div>

 <script>
      const adSlots = {
        "728x90_leaderboard": {
          name: "Leaderboard 1",
          width: 728,
          height: 90,
          template: "DESKTOP/template_leaderboard_728x90.html",
        },
        "970x90_leaderboard": {
          name: "Leaderboard 2",
          width: 970,
          height: 90,
          template: "DESKTOP/template_leaderboard_970x90.html",
        },
        "970x250": {
          name: "Billboard",
          width: 970,
          height: 250,
          template: "DESKTOP/template_billboard.html",
        },
        "300x600": {
          name: "DESKTOP/Giant Banner",
          width: 300,
          height: 600,
          template: "template_giant_banner_desktop.html",
        },
        "300x250_mr1": {
          name: "MR 1",
          width: 300,
          height: 250,
          template: "DESKTOP/template_mr1.html",
        },
        "300x250_mr2": {
          name: "MR 2",
          width: 300,
          height: 250,
          template: "DESKTOP/template_mr2.html",
        },
        "300x250_mr3": {
          name: "MR 3",
          width: 300,
          height: 250,
          template: "DESKTOP/template_mr3.html",
        },
         "1008x60": {
          name: "Horizontal Ad",
          width: 1008,
          height: 60,
          template: "DESKTOP/template_horizontal_ad_desktop_1008x60.html",
        },
         "1100x50": {
          name: "Horizontal Ad",
          width: 1100,
          height: 50,
          template: "DESKTOP/template_horizontal_ad_desktop_1100x50.html",
        },
        "120x600": {
          name: "Skin Ad",
          width: 120,
          height: 600,
          template: "DESKTOP/template_skin_ad.html",
        },
        "160x600": {
          name: "Skyscraper",
          width: 160,
          height: 600,
          template: "DESKTOP/template_skyscraper.html",
        },

        "300x250_baloon": {
          name: "Baloon Ads",
          width: 300,
          height: 250,
          template: "DESKTOP/template_baloon_ads.html",
        },

        "520x730_article_underlay": {
          name: "Article Underlay",
          width: 520,
          height: 730,
          template: "DESKTOP/template_article_underlay_ad.html",
        },

        "300x250_article_inside": {
          name: "Article Inside",
          width: 300,
          height: 250,
          template: "DESKTOP/template_article_inside_ad.html",
        },

        "320x100_below_photo": {
          name: "Below Photo",
          width: 320,
          height: 100,
          template: "DESKTOP/template_below_photo.html",
        },

        "320x100_below_article": {
          name: "Below Article",
          width: 320,
          height: 100,
          template: "DESKTOP/template_below_article.html",
        },

        "468x60_pickwords": {
          name: "Pickwords",
          width: 468,
          height: 60,
          template: "DESKTOP/template_pickwords.html",
        },

        "320x50_top_mobile": {
          name: "Top Banner Mobile 50",
          width: 320,
          height: 50,
          template: "MOBILE/template_top_banner_mobile_320x50.html",
        },

        "320x100_top_mobile": {
          name: "Top Banner Mobile 100",
          width: 320,
          height: 100,
          template: "MOBILE/template_top_banner_mobile_320x100.html",
        },

        "320x150_top_mobile": {
          name: "Top Banner Mobile 150",
          width: 320,
          height: 150,
          template: "MOBILE/template_top_banner_mobile_320x150.html",
        },

        "300x250_middle_mobile": {
          name: "Middle Banner Mobile",
          width: 300,
          height: 250,
          template: "MOBILE/template_middle_banner_mobile.html",
        },

        "320x100_below_photo_mobile": {
          name: "Below Photo Mobile",
          width: 320,
          height: 100,
          template: "MOBILE/template_below_photo_mobile.html",
        },

        "320x100_below_article_mobile": {
          name: "Below Article Mobile",
          width: 320,
          height: 100,
          template: "MOBILE/template_below_article_mobile.html",
        },

        "320x50_horizontal_mobile": {
          name: "Horizontal Mobile",
          width: 320,
          height: 50,
          template: "MOBILE/template_horizontal_mobile_320x50.html",
        },

        "320x100_horizontal_mobile": {
          name: "Horizontal Mobile",
          width: 320,
          height: 100,
          template: "MOBILE/template_horizontal_mobile_320x100.html",
        },

        "640x940_underlay_mobile": {
          name: "Underlay Mobile",
          width: 640,
          height: 940,
          template: "MOBILE/template_underlay_mobile_640x940.html",
        },

        "640x500_underlay_mobile": {
          name: "Underlay Mobile",
          width: 640,
          height: 500,
          template: "MOBILE/template_underlay_mobile_640x500.html",
        }, 

        "300x250_bottom_mobile": {
          name: "Bottom Banner Mobile",
          width: 300,
          height: 250,
          template: "MOBILE/template_bottom_banner_mobile.html",
        },

        "300x250_article_inside_mobile": {
          name: "Article Inside Mobile",
          width: 300,
          height: 250,
          template: "MOBILE/template_article_inside_mobile.html",
        },

        "300x600_giant_mobile": {
          name: "Giant Banner Mobile",
          width: 300,
          height: 600,
          template: "MOBILE/template_giant_mobile.html",
        },

        "320x50_pickwords_mobile": {
          name: "Pickwords Mobile",
          width: 320,
          height: 50,
          template: "MOBILE/template_pickwords_mobile.html",
        },

          "320x480_pushdown_mobile": {
          name: "Pushdown Mobile",
          width: 320,
          height: 480,
          template: "MOBILE/template_pushdown_mobile.html",
        },

      
      };

      const logoUrls = {
        default:
          "https://asset-1.tstatic.net/img/logo/tribun/svg/tribunnews.svg",
        aceh: "https://asset-1.tstatic.net/img/logo/daerah/svg3/serambiindonesia.svg",
        prohaba: "https://asset-1.tstatic.net/img/logo/daerah/svg3/prohaba.svg",
        gayo: "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribungayo.svg",
        medan:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunmedan.svg",
        padang:
          "https://asset-1.tribunnews.com/img/logo/tribun/svg/TribunPadang.svg",
        pekanbaru:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunpekanbaru.svg",
        batam:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunbatam.svg",
        jambi:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunjambi.svg",
        palembang:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/sriwijayapost.svg",
        bangka:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/bangkapos.svg",
        belitung:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/posbelitung.svg",
        bengkulu:
          "https://asset-1.tribunnews.com/img/logo/daerah/svg3/Tribunbengkulu.svg",
        lampung:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunlampung.svg",
        sumsel:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunsumsel.svg",
        jakarta:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunjakarta.svg",
        wartakota:
          "https://asset-1.tribunnews.com/img/logo/daerah/svg3/wartakotalive.svg",
        banten:
          "https://asset-1.tstatic.net/img/logo/tribun/svg/tribunbanten2.svg",
        tangerang:
          "https://asset-1.tribunnews.com/img/logo/daerah/svg3/TribunTangerang.svg",
        jabar:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunjabar5.svg",
        depok:
          "https://asset-1.tribunnews.com/img/logo/daerah/svg3/tribunnewsdepok.svg",
        bekasi:
          "https://asset-1.tribunnews.com/img/logo/daerah/svg3/Tribunbekasi.svg",
        bogor:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunnewsbogor.svg",
        priangan:
          "https://asset-1.tribunnews.com/img/logo/daerah/svg3/TribunPriangan.svg",
        cirebon:
          "https://asset-1.tribunnews.com/img/logo/tribun/svg/TribunCirebon.svg",
        jateng:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunjateng.svg",
        solo: "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunsolo.svg",
        banyumas:
          "https://asset-1.tribunnews.com/img/logo/daerah/svg3/tribunbanyumas3.svg",
        mataraman:
          "https://asset-1.tribunnews.com/img/logo/daerah/svg3/tribunMataraman.svg",
        jatim:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunjatim.svg",
        surabaya: "https://asset-1.tstatic.net/img/logo/daerah/svg3/surya.svg",
        suryamalang:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/suryamalang.svg",
        madura:
          "https://asset-1.tribunnews.com/img/logo/tribun/svg/TribunMadura.svg",
        jogja:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunjogja.svg",
        bali: "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunbali.svg",
        pontianak:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunpontianak.svg",
        kalteng:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunkalteng.svg",
        kaltim:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunkaltim.svg",
        kaltara:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunkaltara.svg",
        banjarmasin:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/banjarmasinpost.svg",
        sulbar:
          "https://asset-1.tribunnews.com/img/logo/daerah/sulbar/tribun-sulbar.com.png",
        makassar:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribuntimur.svg",
        toraja:
          "https://asset-1.tribunnews.com/img/logo/daerah/svg3/TribunToraja.svg",
        sultra:
          "https://asset-1.tribunnews.com/img/logo/daerah/svg3/tribunnewssultra.svg",
        palu: "https://asset-1.tribunnews.com/img/logo/daerah/svg3/Tribun_Palu.svg",
        manado:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunmanado.svg",
        gorontalo:
          "https://asset-1.tribunnews.com/img/logo/daerah/svg3/TribunGorontalo.svg",
        lombok:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunlombok.svg",
        kupang:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/poskupang.svg",
        flores:
          "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunflores.svg",
        ternate:
          "https://asset-1.tribunnews.com/img/logo/tribun/svg/TribunTernate.svg",
        ambon:
          "https://asset-1.tribunnews.com/img/logo/tribun/svg/TribunAmbon.svg",
        papua:
          "https://asset-1.tribunnews.com/img/logo/tribun/svg/TribunPapua.svg",
        papuabarat:
          "https://asset-1.tribunnews.com/img/logo/daerah/svg3/TribunPapuaBarat.svg",
        sorong:
          "https://asset-1.tribunnews.com/img/logo/daerah/svg3/TribunSorong.svg",
        papuatengah:
          "https://asset-1.tribunnews.com/img/logo/daerah/svg3/TribunPapuaTengah.svg",
      };
   
      let processedFiles = {};
      let originalIndexHtml = "";
      let standaloneBlobUrl = "";
      let currentZip = null; 
      let detectedSize = { width: 300, height: 250 };

      const zipInput = document.getElementById("zipInput");
      const dropZone = document.getElementById("dropZone");
      const zipStatus = document.getElementById("zipStatus");
      const auditSection = document.getElementById("auditSection");
      const fileListTable = document.getElementById("fileListTable");
      const standaloneContainer = document.getElementById(
        "standaloneContainer",
      );
      const mainPreview = document.getElementById("mainPreview");
      const generateBtn = document.getElementById("generateBtn");
      const downloadBtn = document.getElementById("downloadBtn");
      const adSlotSelect = document.getElementById("adSlotSelect");

      function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
      }

      ["dragenter", "dragover", "dragleave", "drop"].forEach((eventName) => {
        dropZone.addEventListener(eventName, preventDefaults, false);
      });

      ["dragenter", "dragover"].forEach((eventName) => {
        dropZone.addEventListener(
          eventName,
          () => {
            dropZone.classList.add("drop-zone--over");
          },
          false,
        );
      });

      ["dragleave", "drop"].forEach((eventName) => {
        dropZone.addEventListener(
          eventName,
          () => {
            dropZone.classList.remove("drop-zone--over");
          },
          false,
        );
      });

      dropZone.addEventListener("drop", (e) => {
        const dt = e.dataTransfer;
        const files = dt.files;
        handleFiles(files);
      });

      zipInput.addEventListener("change", (e) => handleFiles(e.target.files));

      async function handleFiles(files) {
        if (files.length === 0) return;
        const file = files[0];

        if (file.type !== "application/zip" && !file.name.endsWith(".zip")) {
          alert("Mohon upload file berformat .zip");
          return;
        }

        document.getElementById("zipName").textContent = file.name;
        document.getElementById("zipSize").textContent = formatBytes(file.size);
        document.getElementById("zipBadge").textContent = "PROCESSING...";
        document.getElementById("zipBadge").className =
          "px-2 py-1 rounded text-[10px] font-bold uppercase bg-yellow-100 text-yellow-700";
        zipStatus.classList.remove("hidden");
        dropZone.classList.add("hidden");

        try {
          await processZip(file);

          document.getElementById("zipBadge").textContent = "LOADED";
          document.getElementById("zipBadge").className =
            "px-2 py-1 rounded text-[10px] font-bold uppercase bg-green-100 text-green-700";
          auditSection.classList.remove("opacity-50", "pointer-events-none");
          auditSection.classList.add("opacity-100");
          checkGenerateState();
        } catch (error) {
          console.error(error);
          alert("Gagal memproses ZIP: " + error.message);
          resetUI();
        }
      }

      async function processZip(file) {
        const jszip = new JSZip();
        
        const zip = await jszip.loadAsync(file);
        currentZip = zip; 

        processedFiles = {};
        const fileEntries = [];
        let mainHtmlContent = "";
        let totalSize = 0;

        const promises = Object.keys(zip.files).map(async (filename) => {
          const zipEntry = zip.files[filename];
          if (zipEntry.dir) return;

          const blob = await zipEntry.async("blob");
          const url = URL.createObjectURL(blob);
          processedFiles[filename] = url;
          totalSize += blob.size;

          if (filename.match(/index\.html?$/i)) {
            mainHtmlContent = await zipEntry.async("string");
          }

          fileEntries.push({
            name: filename,
            size: blob.size,
            type: blob.type,
          });
        });

        await Promise.all(promises);

        if (!mainHtmlContent) {
          throw new Error("File index.html tidak ditemukan dalam ZIP!");
        }

        originalIndexHtml = rewritePaths(mainHtmlContent, processedFiles);
        updateAuditUI(fileEntries, totalSize);

        const autoSize = detectSizeFromHtml(originalIndexHtml);
        if (autoSize) {
          detectedSize = autoSize;
          autoSelectDropdown(autoSize.width, autoSize.height);
        } else {
          detectedSize = { width: 300, height: 250 };
        }

        const blob = new Blob([originalIndexHtml], { type: "text/html" });
        standaloneBlobUrl = URL.createObjectURL(blob);

        renderStandalone();
      }

      async function generateTemplate() {
        if (!standaloneBlobUrl) return;

        const slotId = adSlotSelect.value;
        const logoKey = document.getElementById("logoSelect").value;
        const slot = adSlots[slotId];

        mainPreview.classList.add("hidden");
        document.getElementById("placeholderPreview").innerHTML =
          `<div class="spinner"></div><p class="mt-4 text-slate-500 font-medium text-sm">Menyiapkan halaman...</p>`;
        document
          .getElementById("placeholderPreview")
          .classList.remove("hidden");

        try {
          const response = await fetch(slot.template);
          if (!response.ok) throw new Error("Template tidak ditemukan");
          let html = await response.text();

          html = html.replace(
            new RegExp(
              "https://asset-1.tstatic.net/img/logo/tribun/svg/tribunnews.svg",
              "g",
            ),
            logoUrls[logoKey],
          );

          
          const adIframeString = `
                <iframe src="${standaloneBlobUrl}" 
                        width="${slot.width}" 
                        height="${slot.height}" 
                        frameborder="0" 
                        scrolling="no" 
                        style="border:none; overflow:hidden;">
                </iframe>`;

          const parser = new DOMParser();
          const doc = parser.parseFromString(html, "text/html");

          doc.querySelectorAll(".ad-slot").forEach((el) => {
            el.innerHTML = adIframeString;
            el.style.display = "flex";
            el.style.justifyContent = "center";
          });

          mainPreview.contentDocument.open();
          mainPreview.contentDocument.write(doc.documentElement.outerHTML);
          mainPreview.contentDocument.close();

          const isMobile = ["mobile"].some((k) => slotId.includes(k));
          mainPreview.style.width = isMobile ? "400px" : "100%";

          mainPreview.classList.remove("hidden");
          document.getElementById("placeholderPreview").classList.add("hidden");
          downloadBtn.disabled = false;
        } catch (err) {
          console.error(err);
          alert("Gagal load template: " + err.message);
          document.getElementById("placeholderPreview").innerHTML =
            `<p class="text-red-500">Error.</p>`;
        }
      }

      function detectSizeFromHtml(html) {
        const regex =
          /<meta\s+name=["']ad.size["']\s+content=["']width=(\d+)[^0-9]*height=(\d+)["']/i;
        const match = html.match(regex);
        if (match) {
          return { width: parseInt(match[1]), height: parseInt(match[2]) };
        }
        return null;
      }

      function autoSelectDropdown(w, h) {
        const sizeStr = `${w}x${h}`;
        let found = false;

        for (let i = 0; i < adSlotSelect.options.length; i++) {
          if (adSlotSelect.options[i].value.includes(sizeStr)) {
            adSlotSelect.selectedIndex = i;
            found = true;
            break;
          }
        }

        onSlotChange();
      }

      function rewritePaths(html, fileMap) {
        let newHtml = html;
        const filenames = Object.keys(fileMap).sort(
          (a, b) => b.length - a.length,
        );
        filenames.forEach((filename) => {
          const cleanName = filename.split("/").pop();
          if (!filename.endsWith("index.html")) {
            newHtml = newHtml.split(filename).join(fileMap[filename]);
          }
        });
        return newHtml;
      }

      function renderStandalone() {
        if (!standaloneBlobUrl) return;

        const container = document.getElementById("standaloneContainer");
        container.innerHTML = "";

        const iframe = document.createElement("iframe");
        iframe.className = "preview-standalone bg-white";
        iframe.id = "standaloneIframe";
        iframe.src = standaloneBlobUrl;

        iframe.style.overflow = "hidden";
        iframe.scrolling = "no";

        updateStandaloneSize(iframe);
        container.appendChild(iframe);
      }

      function updateStandaloneSize(iframeElement) {
        const slotId = adSlotSelect.value;
        const ifr =
          iframeElement || document.getElementById("standaloneIframe");
        const badge = document.getElementById("activeSizeBadge");
        const info = document.getElementById("standaloneDimensionsInfo");

        if (!ifr) return;

        let width, height;

        if (slotId && adSlots[slotId]) {
          const slot = adSlots[slotId];
          width = slot.width;
          height = slot.height;
        } else {
          width = detectedSize.width;
          height = detectedSize.height;
        }

        ifr.style.width = width + "px";
        ifr.style.height = height + "px";

        badge.textContent = `${width} x ${height}`;
        info.classList.remove("hidden");
      }

      function onSlotChange() {
        updateStandaloneSize();
        checkGenerateState();

        const slotId = adSlotSelect.value;
        const badgeDiv = document.getElementById("responsiveBadge");
        const modeSpan = document.getElementById("modeName");

        if (slotId) {
          badgeDiv.classList.remove("hidden");
          const isMobile = slotId.includes("mobile");
          modeSpan.textContent = isMobile ? "Mobile View" : "Desktop View";
        } else {
          badgeDiv.classList.add("hidden");
        }
      }

      function updateAuditUI(files, totalSize) {
        document.getElementById("totalFiles").textContent = files.length;
        document.getElementById("mainLoadSize").textContent =
          formatBytes(totalSize);

        const tableBody = document.getElementById("fileListTable");
        tableBody.innerHTML = "";

        files.forEach((f) => {
          const row = document.createElement("tr");
          const isIndex = f.name.includes("index.html");
          row.innerHTML = `
                <td class="py-2 px-1 truncate max-w-[120px] ${isIndex ? "font-bold text-blue-600" : "text-slate-600"}">${f.name}</td>
                <td class="py-2 px-1 text-right text-slate-500">${formatBytes(f.size)}</td>
            `;
          tableBody.appendChild(row);
        });
      }

      function formatBytes(bytes, decimals = 2) {
        if (!+bytes) return "0 Bytes";
        const k = 1024;
        const dm = decimals < 0 ? 0 : decimals;
        const sizes = ["Bytes", "KB", "MB", "GB"];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return `${parseFloat((bytes / Math.pow(k, i)).toFixed(dm))} ${sizes[i]}`;
      }

      function checkGenerateState() {
        const slot = adSlotSelect.value;
        generateBtn.disabled = !(standaloneBlobUrl && slot);
      }

      function reloadStandalone() {
        const ifr = document.getElementById("standaloneIframe");
        if (ifr) ifr.src = ifr.src;
      }

      function togglePreviewBorder() {
        const ifr = document.getElementById("standaloneIframe");
        if (ifr) ifr.classList.toggle("show-border");
      }

      function resetUI() {
        zipStatus.classList.add("hidden");
        dropZone.classList.remove("hidden");
        auditSection.classList.add("opacity-50", "pointer-events-none");
        generateBtn.disabled = true;
        currentZip = null;
      }

      async function downloadBundle() {
        const slotId = adSlotSelect.value;
        if (!slotId || !currentZip) return;

        const downloadBtnRef = document.getElementById("downloadBtn");
        const originalText = downloadBtnRef.innerHTML;
        downloadBtnRef.disabled = true;
        downloadBtnRef.innerHTML = "üì¶ Zipping...";

        try {
            const slot = adSlots[slotId];
            const logoKey = document.getElementById("logoSelect").value;
            const newZip = new JSZip();

            
            const adFolder = newZip.folder("ad-content");

            
            
            let adEntryPoint = "index.html"; 

            const promises = Object.keys(currentZip.files).map(async (filename) => {
                
                if (filename.startsWith("__") || filename.includes(".DS_Store")) return;
                
                const file = currentZip.files[filename];
                if (!file.dir) {
                    const content = await file.async("blob");
                    adFolder.file(filename, content);
                    
                    
                    if (filename.match(/index\.html?$/i)) {
                        adEntryPoint = filename;
                    }
                }
            });

            await Promise.all(promises);

            
            const response = await fetch(slot.template);
            let htmlTemplate = await response.text();

            
            htmlTemplate = htmlTemplate.replace(
                new RegExp(
                    "https://asset-1.tstatic.net/img/logo/tribun/svg/tribunnews.svg",
                    "g",
                ),
                logoUrls[logoKey],
            );

            
            
            const adIframeString = `
                <iframe src="ad-content/${adEntryPoint}" 
                        width="${slot.width}" 
                        height="${slot.height}" 
                        frameborder="0" 
                        scrolling="no" 
                        style="border:none; overflow:hidden;">
                </iframe>`;

            
            const parser = new DOMParser();
            const doc = parser.parseFromString(htmlTemplate, "text/html");

            doc.querySelectorAll(".ad-slot").forEach((el) => {
                el.innerHTML = adIframeString;
                el.style.display = "flex";
                el.style.justifyContent = "center";
            });

            
            newZip.file("index.html", doc.documentElement.outerHTML);

            
            const zipBlob = await newZip.generateAsync({ type: "blob" });
            const url = URL.createObjectURL(zipBlob);
            const name = slot.name.replace(/\s/g, "_").toLowerCase();

            const a = document.createElement("a");
            a.href = url;
            a.download = `bundle_${name}_tribun.zip`;
            a.click();

            
            setTimeout(() => URL.revokeObjectURL(url), 1000);

        } catch (error) {
            console.error("Error creating bundle:", error);
            alert("Gagal membuat zip bundle.");
        } finally {
            downloadBtnRef.disabled = false;
            downloadBtnRef.innerHTML = originalText;
        }
      }
    </script>
  </body>
</html>
