<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Image Ad Inspector & Builder</title>
    <link
      rel="shortcut icon"
      href="https://asset-1.tstatic.net/img/icon/tribun-icon_32.png"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap");

      body {
        font-family: "Inter", sans-serif;
        background-color: #f1f5f9;
      }

      .drop-zone--over {
        border-color: #3b82f6;
        background-color: #eff6ff;
      }

      .spinner {
        border: 3px solid rgba(0, 0, 0, 0.1);
        width: 24px;
        height: 24px;
        border-radius: 50%;
        border-left-color: #3b82f6;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      #standaloneImage {
        transition: all 0.3s ease;
        max-width: 100%;
        height: auto;
      }

      .show-border {
        outline: 1px solid #cbd5e1;
      }

      .bg-checkered {
        background-image:
          linear-gradient(45deg, #e2e8f0 25%, transparent 25%),
          linear-gradient(-45deg, #e2e8f0 25%, transparent 25%),
          linear-gradient(45deg, transparent 75%, #e2e8f0 75%),
          linear-gradient(-45deg, transparent 75%, #e2e8f0 75%);
        background-size: 20px 20px;
        background-position:
          0 0,
          0 10px,
          10px -10px,
          -10px 0px;
      }
    </style>
  </head>
  <body class="p-4 md:p-8">
    <div >

      <div class="max-w-7xl mx-auto">
        <header class="mb-8 text-center">
          <h1 class="text-3xl font-bold text-slate-800">üñºÔ∏è Image Ad Inspector</h1>
          <p class="text-slate-500 mt-2 text-sm">
            Audit resolusi, cek rasio aspek, dan simulasikan iklan gambar
            (JPG/PNG/GIF).
          </p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
          <div class="space-y-6">
            <div
              class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200"
            >
              <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                <span
                  class="p-2 bg-blue-100 text-blue-600 rounded-lg text-xs font-bold"
                  >1</span
                >
                Upload Image Ad
              </h2>
              <div
                id="dropZone"
                class="border-2 border-dashed border-slate-300 rounded-xl p-8 text-center hover:border-blue-500 transition-colors cursor-pointer relative"
              >
                <input
                  type="file"
                  id="imageInput"
                  class="absolute inset-0 opacity-0 cursor-pointer"
                  accept="image/png, image/jpeg, image/gif"
                />
                <div class="text-slate-400 text-4xl mb-2">üì∏</div>
                <p class="text-sm font-medium text-slate-600">
                  Klik atau drag gambar di sini
                </p>
                <p class="text-xs text-slate-400 mt-1">
                  Mendukung JPG, PNG, atau GIF
                </p>
              </div>
            </div>

            <div
              class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200"
            >
              <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                <span
                  class="p-2 bg-purple-100 text-purple-600 rounded-lg text-xs font-bold"
                  >2</span
                >
                Template & Format
              </h2>
              <div class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <label
                      class="block text-[10px] font-bold text-slate-500 uppercase mb-2"
                      >Pilih Format Iklan</label
                    >
                    <select
                      id="adSlotSelect"
                      onchange="validateDimensions()"
                      class="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm outline-none focus:ring-2 focus:ring-blue-500 transition-all"
                    >
                      <option value="">-- Pilih Format --</option>
                      <optgroup label="Desktop">
                        <option value="728x90_leaderboard">
                          Leaderboard (728x90)
                        </option>
                        <option value="970x90_leaderboard">
                          Leaderboard (970x90)
                        </option>
                        <option value="970x250">Billboard (970x250)</option>
                        <option value="300x600">Giant Banner (300x600)</option>
                        <option value="300x250_mr1">MR 1 (300x250)</option>
                        <option value="300x250_mr2">MR 2 (300x250)</option>
                        <option value="300x250_mr3">MR 3 (300x250)</option>
                        <option value="1100x50">Horizontal Ad (1100x50)</option>
                        <option value="520x730_article_underlay">
                          Underlay (520x720)
                        </option>
                        <option value="160x600">Skyscraper (160x600)</option>
                        <option value="320x100_below_photo">
                          Below Photo (320x100)
                        </option>
                        <option value="320x100_below_article">
                          Below Article (320x100)
                        </option>
                        <option value="300x250_baloon">
                          Baloon Ads (300x250)
                        </option>
                        <option value="300x250_article_inside">
                          Inside Ads (300x250)
                        </option>
                        <option value="468x60_pickwords">
                          Pickwords (468x60)
                        </option>
                      </optgroup>

                      <optgroup label="Mobile">
                        <option value="320x50_top_mobile">
                          Top Banner (320x50)
                        </option>
                        <option value="320x100_top_mobile">
                          Top Banner (320x100)
                        </option>
                        <option value="320x150_top_mobile">
                          Top Banner (320x150)
                        </option>
                        <option value="300x250_middle_mobile">
                          Middle Banner (300x250)
                        </option>
                        <option value="320x100_below_photo_mobile">
                          Below Photo (320x100)
                        </option>
                        <option value="320x100_below_article_mobile">
                          Below Article (320x100)
                        </option>
                        <option value="320x50_horizontal_mobile">
                          Horizontal Banner (320x50)
                        </option>
                        <option value="320x100_horizontal_mobile">
                          Horizontal Banner (320x100)
                        </option>
                        <option value="640x940_underlay_mobile">
                          Underlay (640x940)
                        </option>
                        <option value="640x500_underlay_mobile">
                          Underlay (640x500)
                        </option>  </option>
                        <option value="300x250_bottom_mobile">
                          Bottom Banner (300x250)
                        </option>
                        <option value="300x250_article_inside_mobile">
                          Article Inside (300x250)                    
                        <option value="300x600_giant_mobile">
                          Giant Banner (300x600)
                        </option>
                        <option value="320x50_pickwords_mobile">
                          Pickwords Banner (320x50)
                        </option>
                          <option value="320x480_pushdown_mobile">
                          Pushdown Banner (320x480)
                        </option>
                      
                      </optgroup>
                    </select>
                  </div>
                  <div>
                    <label
                      class="block text-[10px] font-bold text-slate-500 uppercase mb-2"
                      >Ganti Logo Daerah</label
                    >
                     <select
                      id="logoSelect"
                      class="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm outline-none"
                    >
                      <option value="default">Default (Tribunnews)</option>
                      <option value="aceh">Serambi News</option>
                      <option value="prohaba">Prohaba</option>
                      <option value="gayo">Tribun Gayo</option>
                      <option value="medan">Tribun Medan</option>
                      <option value="padang">Tribun Padang</option>
                      <option value="pekanbaru">Tribun Pekanbaru</option>
                      <option value="batam">Tribun Batam</option>
                      <option value="jambi">Tribun Jambi</option>
                      <option value="palembang">Sripoku</option>
                      <option value="bangka">Bangka Pos</option>
                      <option value="belitung">Pos Belitung</option>
                      <option value="bengkulu">Tribun Bengkulu</option>
                      <option value="lampung">Tribun Lampung</option>
                      <option value="sumsel">Tribun Sumsel</option>
                      <option value="jakarta">Tribun Jakarta</option>
                      <option value="wartakota">Warta Kota</option>
                      <option value="banten">Tribun Banten</option>
                      <option value="tangerang">Tribun Tangerang</option>
                      <option value="jabar">Tribun Jabar</option>
                      <option value="depok">Tribun Depok</option>
                      <option value="bekasi">Tribun Bekasi</option>
                      <option value="bogor">Tribunnews Bogor</option>
                      <option value="priangan">Tribun Priangan</option>
                      <option value="cirebon">Tribun Cirebon</option>
                      <option value="jateng">Tribun Jateng</option>
                      <option value="solo">Tribun Solo</option>
                      <option value="banyumas">Tribun Banyumas</option>
                      <option value="mataraman">Tribun Mataraman</option>
                      <option value="jatim">Tribun Jatim</option>
                      <option value="surabaya">Surya</option>
                      <option value="suryamalang">Surya Malang</option>
                      <option value="madura">Tribun Madura</option>
                      <option value="jogja">Tribun Jogja</option>
                      <option value="bali">Tribun Bali</option>
                      <option value="pontianak">Tribun Pontianak</option>
                      <option value="kalteng">Tribun Kalteng</option>
                      <option value="kaltim">Tribun Kaltim</option>
                      <option value="kaltara">Tribun Kaltara</option>
                      <option value="banjarmasin">Banjarmasin Post</option>
                      <option value="sulbar">Tribun Sulbar</option>
                      <option value="makassar">Tribun Timur</option>
                      <option value="toraja">Tribun Toraja</option>
                      <option value="sultra">Tribun Sultra</option>
                      <option value="palu">Tribun Palu</option>
                      <option value="manado">Tribun Manado</option>
                      <option value="gorontalo">Tribun Gorontalo</option>
                      <option value="lombok">Tribun Lombok</option>
                      <option value="kupang">Pos Kupang</option>
                      <option value="flores">Tribun Flores</option>
                      <option value="ternate">Tribun Ternate</option>
                      <option value="ambon">Tribun Ambon</option>
                      <option value="papua">Tribun Papua</option>
                      <option value="papuabarat">Tribun Papua Barat</option>
                      <option value="sorong">Tribun Sorong</option>
                      <option value="papuatengah">Tribun Papua Tengah</option>
                    </select>
                  </div>
                </div>
                <div>
                  <label
                    class="block text-[10px] font-bold text-slate-500 uppercase mb-2"
                    >Landing Page URL</label
                  >
                  <input
                    type="text"
                    id="lpInput"
                    placeholder="https://www.example.com"
                    class="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm outline-none"
                  />
                </div>
                <div class="flex gap-3">
                  <button
                    id="generateBtn"
                    disabled
                    onclick="generateTemplate()"
                    class="flex-[2] bg-blue-600 text-white font-bold py-3 rounded-xl shadow-lg shadow-blue-200 hover:bg-blue-700 disabled:bg-slate-300 disabled:shadow-none transition-all"
                  >
                    üöÄ Preview di Website
                  </button>
                  <button
                    id="downloadBtn"
                    disabled
                    onclick="downloadBundle()"
                    class="flex-1 bg-slate-800 text-white font-bold py-3 rounded-xl hover:bg-slate-900 disabled:bg-slate-200 transition-all"
                  >
                    üíæ Download ZIP
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div
            id="inspectorPanel"
            class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 flex flex-col"
          >
            <div class="flex items-center justify-between mb-6">
              <div>
                <h2 class="text-lg font-semibold text-slate-800">
                  üîç Image Inspector
                </h2>
                <p class="text-xs text-slate-400 font-medium">
                  Audit visual & optimasi resolusi
                </p>
              </div>
              <div class="flex gap-2">
                <button
                  onclick="toggleTransparency()"
                  class="p-2 bg-slate-50 hover:bg-slate-100 rounded-lg text-slate-500 border border-slate-200 transition-colors"
                  title="Checkered Background"
                >
                  üèÅ
                </button>
                <button
                  onclick="toggleBorder()"
                  class="p-2 bg-slate-50 hover:bg-slate-100 rounded-lg text-slate-500 border border-slate-200 transition-colors"
                  title="Toggle Border"
                >
                  üî≤
                </button>
              </div>
            </div>

            <div
              id="imageContainer"
              class="flex-1 bg-slate-50 rounded-2xl overflow-auto flex items-center justify-center min-h-[300px] border-4 border-dashed border-slate-100 p-8 relative"
            >
              <img id="standaloneImage" src="" class="hidden shadow-2xl" />
              <div id="uploadPlaceholder" class="text-center text-slate-300">
                <div class="text-5xl mb-4">üñºÔ∏è</div>
                <p class="text-sm italic font-medium">
                  Materi akan muncul di sini
                </p>
              </div>
            </div>

            <div
              id="auditInfo"
              class="mt-6 pt-4 border-t border-slate-100 hidden"
            >
              <div class="grid grid-cols-3 gap-4 mb-4">
                <div class="text-center border-r border-slate-100">
                  <p
                    class="text-[9px] font-bold text-slate-400 uppercase tracking-wider"
                  >
                    Resolution
                  </p>
                  <p id="infoRes" class="text-sm font-bold text-slate-700">-</p>
                </div>
                <div class="text-center border-r border-slate-100">
                  <p
                    class="text-[9px] font-bold text-slate-400 uppercase tracking-wider"
                  >
                    File Size
                  </p>
                  <p id="infoSize" class="text-sm font-bold text-slate-700">-</p>
                </div>
                <div class="text-center">
                  <p
                    class="text-[9px] font-bold text-slate-400 uppercase tracking-wider"
                  >
                    Status
                  </p>
                  <p
                    id="infoStatus"
                    class="text-[10px] font-bold px-2 py-0.5 rounded-full inline-block"
                  >
                    -
                  </p>
                </div>
              </div>

              <div
                id="dimWarning"
                class="p-3 rounded-xl text-[10px] flex flex-col gap-3 font-medium border hidden"
              >
                <div id="statusMessage" class="flex items-center gap-2"></div>

                <div id="resizeOptions" class="hidden">
                  <p
                    class="text-[9px] font-bold uppercase text-slate-400 mb-2 border-t pt-2 border-white/30"
                  >
                    Optimasi Materi (Resize Otomatis)
                  </p>
                  <div class="flex gap-2">
                    <button
                      onclick="resizeAndDownload(1)"
                      id="btnResize1x"
                      class="flex-1 bg-white/20 hover:bg-white/40 py-2 rounded-lg border border-white/30 transition-all font-bold"
                    >
                      ‚¨áÔ∏è Download 1x
                    </button>
                    <button
                      onclick="resizeAndDownload(2)"
                      id="btnResize2x"
                      class="flex-1 bg-white/20 hover:bg-white/40 py-2 rounded-lg border border-white/30 transition-all font-bold"
                    >
                      ‚¨áÔ∏è Download 2x
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="bg-white max-w-full p-6 rounded-2xl shadow-sm border border-slate-200">
        <h2
          class="text-xl font-bold text-slate-800 mb-6 flex items-center gap-2"
        >
          üìã Website Context Preview
        </h2>
        <div
          id="iframeWrapper"
          class="relative bg-slate-100 rounded-xl overflow-hidden min-h-[600px] border border-slate-100 flex justify-center p-4"
        >
          <iframe
            id="mainPreview"
            class="bg-white shadow-2xl hidden transition-all duration-500 origin-top"
          ></iframe>
          <div
            id="placeholderPreview"
            class="flex flex-col items-center justify-center p-20 text-center opacity-40"
          >
            <div class="text-7xl mb-6">üåê</div>
            <p class="text-slate-500 max-w-md font-medium">
              Klik "Preview di Website" untuk melihat simulasi iklan pada
              halaman berita.
            </p>
          </div>
        </div>
      </div>
    </div>

    <script>
      const adSlots = {
        "728x90_leaderboard": {
          name: "Leaderboard 1",
          width: 728,
          height: 90,
          template: "DESKTOP/template_leaderboard_728x90.html",
        },
        "970x90_leaderboard": {
          name: "Leaderboard 2",
          width: 970,
          height: 90,
          template: "DESKTOP/template_leaderboard_970x90.html",
        },
        "970x250": {
          name: "Billboard",
          width: 970,
          height: 250,
          template: "DESKTOP/template_billboard.html",
        },
        "300x600": {
          name: "Giant Banner",
          width: 300,
          height: 600,
          template: "DESKTOP/template_giant_banner_desktop.html",
        },
        "300x250_mr1": {
          name: "MR 1",
          width: 300,
          height: 250,
          template: "DESKTOP/template_mr1.html",
        },
        "300x250_mr2": {
          name: "MR 2",
          width: 300,
          height: 250,
          template: "DESKTOP/template_mr2.html",
        },
        "300x250_mr3": {
          name: "MR 3",
          width: 300,
          height: 250,
          template: "DESKTOP/template_mr3.html",
        },
        "1100x50": {
          name: "Horizontal Ad",
          width: 1100,
          height: 50,
          template: "DESKTOP/template_horizontal_ad_desktop.html",
        },
        "120x600": {
          name: "Skin Ad",
          width: 120,
          height: 600,
          template: "DESKTOP/template_skin_ad.html",
        },
        "160x600": {
          name: "Skyscraper",
          width: 160,
          height: 600,
          template: "DESKTOP/template_skyscraper.html",
        },

        "300x250_baloon": {
          name: "Baloon Ads",
          width: 300,
          height: 250,
          template: "DESKTOP/template_baloon_ads.html",
        },

        "520x730_article_underlay": {
          name: "Article Underlay",
          width: 520,
          height: 730,
          template: "DESKTOP/template_article_underlay_ad.html",
        },

        "300x250_article_inside": {
          name: "Article Inside",
          width: 300,
          height: 250,
          template: "DESKTOP/template_article_inside_ad.html",
        },

        "320x100_below_photo": {
          name: "Below Photo",
          width: 320,
          height: 100,
          template: "DESKTOP/template_below_photo.html",
        },

        "320x100_below_article": {
          name: "Below Article",
          width: 320,
          height: 100,
          template: "DESKTOP/template_below_article.html",
        },

        "468x60_pickwords": {
          name: "Pickwords",
          width: 468,
          height: 60,
          template: "DESKTOP/template_pickwords.html",
        },

        "320x50_top_mobile": {
          name: "Top Banner Mobile 50",
          width: 320,
          height: 50,
          template: "MOBILE/template_top_banner_mobile_320x50.html",
        },

        "320x100_top_mobile": {
          name: "Top Banner Mobile 100",
          width: 320,
          height: 100,
          template: "MOBILE/template_top_banner_mobile_320x100.html",
        },

        "320x150_top_mobile": {
          name: "Top Banner Mobile 150",
          width: 320,
          height: 150,
          template: "MOBILE/template_top_banner_mobile_320x150.html",
        },

        "300x250_middle_mobile": {
          name: "Middle Banner Mobile",
          width: 300,
          height: 250,
          template: "MOBILE/template_middle_banner_mobile.html",
        },

        "320x100_below_photo_mobile": {
          name: "Below Photo Mobile",
          width: 320,
          height: 100,
          template: "MOBILE/template_below_photo_mobile.html",
        },

        "320x100_below_article_mobile": {
          name: "Below Article Mobile",
          width: 320,
          height: 100,
          template: "MOBILE/template_below_article_mobile.html",
        },

          "320x50_horizontal_mobile": {
          name: "Horizontal Mobile",
          width: 320,
          height: 50,
          template: "MOBILE/template_horizontal_mobile_320x50.html",
        },

        "320x100_horizontal_mobile": {
          name: "Horizontal Mobile",
          width: 320,
          height: 100,
          template: "MOBILE/template_horizontal_mobile_320x100.html",
        },

        "640x940_underlay_mobile": {
          name: "Underlay Mobile",
          width: 640,
          height: 940,
          template: "MOBILE/template_underlay_mobile_640x940.html",
        },

        "640x500_underlay_mobile": {
          name: "Underlay Mobile",
          width: 640,
          height: 500,
          template: "MOBILE/template_underlay_mobile_640x500.html",
        },

        "300x250_bottom_mobile": {
          name: "Bottom Banner Mobile",
          width: 300,
          height: 250,
          template: "MOBILE/template_bottom_banner_mobile.html",
        },

        "300x250_article_inside_mobile": {
          name: "Article Inside Mobile",
          width: 300,
          height: 250,
          template: "MOBILE/template_article_inside_mobile.html",
        },
     
        "300x600_giant_mobile": {
          name: "Giant Banner Mobile",
          width: 300,
          height: 600,
          template: "MOBILE/template_giant_mobile.html",
        },

        "320x50_pickwords_mobile": {
          name: "Pickwords Mobile",
          width: 320,
          height: 50,
          template: "MOBILE/template_pickwords_mobile.html",
        },

         "320x480_pushdown_mobile": {
          name: "Pushdown Mobile",
          width: 320,
          height: 480,
          template: "MOBILE/template_pushdown_mobile.html",
        },

      

      };

      const logoUrls = {
          default:
            "https://asset-1.tstatic.net/img/logo/tribun/svg/tribunnews.svg",
          aceh: "https://asset-1.tstatic.net/img/logo/daerah/svg3/serambiindonesia.svg",
          prohaba: "https://asset-1.tstatic.net/img/logo/daerah/svg3/prohaba.svg",
          gayo: "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribungayo.svg",
          medan:
            "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunmedan.svg",
          padang:
            "https://asset-1.tribunnews.com/img/logo/tribun/svg/TribunPadang.svg",
          pekanbaru:
            "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunpekanbaru.svg",
          batam:
            "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunbatam.svg",
          jambi:
            "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunjambi.svg",
          palembang:
            "https://asset-1.tstatic.net/img/logo/daerah/svg3/sriwijayapost.svg",
          bangka:
            "https://asset-1.tstatic.net/img/logo/daerah/svg3/bangkapos.svg",
          belitung:
            "https://asset-1.tstatic.net/img/logo/daerah/svg3/posbelitung.svg",
          bengkulu:
            "https://asset-1.tribunnews.com/img/logo/daerah/svg3/Tribunbengkulu.svg",
          lampung:
            "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunlampung.svg",
          sumsel:
            "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunsumsel.svg",
          jakarta:
            "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunjakarta.svg",
          wartakota:
            "https://asset-1.tribunnews.com/img/logo/daerah/svg3/wartakotalive.svg",
          banten:
            "https://asset-1.tstatic.net/img/logo/tribun/svg/tribunbanten2.svg",
          tangerang:
            "https://asset-1.tribunnews.com/img/logo/daerah/svg3/TribunTangerang.svg",
          jabar:
            "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunjabar5.svg",
          depok:
            "https://asset-1.tribunnews.com/img/logo/daerah/svg3/tribunnewsdepok.svg",
          bekasi:
            "https://asset-1.tribunnews.com/img/logo/daerah/svg3/Tribunbekasi.svg",
          bogor:
            "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunnewsbogor.svg",
          priangan:
            "https://asset-1.tribunnews.com/img/logo/daerah/svg3/TribunPriangan.svg",
          cirebon:
            "https://asset-1.tribunnews.com/img/logo/tribun/svg/TribunCirebon.svg",
          jateng:
            "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunjateng.svg",
          solo: "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunsolo.svg",
          banyumas:
            "https://asset-1.tribunnews.com/img/logo/daerah/svg3/tribunbanyumas3.svg",
          mataraman:
            "https://asset-1.tribunnews.com/img/logo/daerah/svg3/tribunMataraman.svg",
          jatim:
            "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunjatim.svg",
          surabaya: "https://asset-1.tstatic.net/img/logo/daerah/svg3/surya.svg",
          suryamalang:
            "https://asset-1.tstatic.net/img/logo/daerah/svg3/suryamalang.svg",
          madura:
            "https://asset-1.tribunnews.com/img/logo/tribun/svg/TribunMadura.svg",
          jogja:
            "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunjogja.svg",
          bali: "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunbali.svg",
          pontianak:
            "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunpontianak.svg",
          kalteng:
            "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunkalteng.svg",
          kaltim:
            "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunkaltim.svg",
          kaltara:
            "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunkaltara.svg",
          banjarmasin:
            "https://asset-1.tstatic.net/img/logo/daerah/svg3/banjarmasinpost.svg",
          sulbar:
            "https://asset-1.tribunnews.com/img/logo/daerah/sulbar/tribun-sulbar.com.png",
          makassar:
            "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribuntimur.svg",
          toraja:
            "https://asset-1.tribunnews.com/img/logo/daerah/svg3/TribunToraja.svg",
          sultra:
            "https://asset-1.tribunnews.com/img/logo/daerah/svg3/tribunnewssultra.svg",
          palu: "https://asset-1.tribunnews.com/img/logo/daerah/svg3/Tribun_Palu.svg",
          manado:
            "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunmanado.svg",
          gorontalo:
            "https://asset-1.tribunnews.com/img/logo/daerah/svg3/TribunGorontalo.svg",
          lombok:
            "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunlombok.svg",
          kupang:
            "https://asset-1.tstatic.net/img/logo/daerah/svg3/poskupang.svg",
          flores:
            "https://asset-1.tstatic.net/img/logo/daerah/svg3/tribunflores.svg",
          ternate:
            "https://asset-1.tribunnews.com/img/logo/tribun/svg/TribunTernate.svg",
          ambon:
            "https://asset-1.tribunnews.com/img/logo/tribun/svg/TribunAmbon.svg",
          papua:
            "https://asset-1.tribunnews.com/img/logo/tribun/svg/TribunPapua.svg",
          papuabarat:
            "https://asset-1.tribunnews.com/img/logo/daerah/svg3/TribunPapuaBarat.svg",
          sorong:
            "https://asset-1.tribunnews.com/img/logo/daerah/svg3/TribunSorong.svg",
          papuatengah:
            "https://asset-1.tribunnews.com/img/logo/daerah/svg3/TribunPapuaTengah.svg",
        };
   

      let uploadedImgData = null;
      let imgNaturalWidth = 0;
      let imgNaturalHeight = 0;
      let originalFile = null;

      window.onload = () => {
        const input = document.getElementById("imageInput");
        const dropZone = document.getElementById("dropZone");

        input.addEventListener("change", (e) =>
          handleImageFile(e.target.files[0]),
        );

        ["dragover", "dragleave", "drop"].forEach((evt) => {
          dropZone.addEventListener(evt, (e) => {
            e.preventDefault();
            if (evt === "dragover") dropZone.classList.add("drop-zone--over");
            else dropZone.classList.remove("drop-zone--over");
            if (evt === "drop") handleImageFile(e.dataTransfer.files[0]);
          });
        });
      };

      function handleImageFile(file) {
        if (!file || !file.type.startsWith("image/")) return;
        originalFile = file;

        const reader = new FileReader();
        reader.onload = (e) => {
          const img = new Image();
          img.onload = () => {
            uploadedImgData = e.target.result;
            imgNaturalWidth = img.width;
            imgNaturalHeight = img.height;

            document.getElementById("standaloneImage").src = uploadedImgData;
            document
              .getElementById("standaloneImage")
              .classList.remove("hidden");
            document
              .getElementById("uploadPlaceholder")
              .classList.add("hidden");
            document.getElementById("auditInfo").classList.remove("hidden");

            updateAuditDisplay(file);
            autoDetectSlot();
          };
          img.src = e.target.result;
        };
        reader.readAsDataURL(file);
      }

      function autoDetectSlot() {
        const uploadedRatio = imgNaturalWidth / imgNaturalHeight;
        let bestSlot = "";
        let minDiff = Infinity;

        for (const key in adSlots) {
          const slotRatio = adSlots[key].width / adSlots[key].height;
          const diff = Math.abs(uploadedRatio - slotRatio);

          if (diff < 0.02 && diff < minDiff) {
            minDiff = diff;
            bestSlot = key;
          }
        }

        if (bestSlot) {
          document.getElementById("adSlotSelect").value = bestSlot;
        } else {
          document.getElementById("adSlotSelect").value = "";
        }

        validateDimensions();
      }

      function updateAuditDisplay(file) {
        document.getElementById("infoRes").textContent =
          `${imgNaturalWidth} x ${imgNaturalHeight}`;
        const sizeKB = (file.size / 1024).toFixed(1);
        document.getElementById("infoSize").textContent = `${sizeKB} KB`;

        const status = document.getElementById("infoStatus");
        const isMegaHighRes = imgNaturalWidth > 1500 || imgNaturalHeight > 1500;
        const weightLimit = isMegaHighRes ? 500 : 250;

        if (file.size > weightLimit * 1024) {
          status.textContent = "HEAVY";
          status.className =
            "text-[10px] font-bold px-2 py-0.5 rounded-full inline-block bg-red-100 text-red-600";
        } else {
          status.textContent = "SAFE";
          status.className =
            "text-[10px] font-bold px-2 py-0.5 rounded-full inline-block bg-green-100 text-green-600";
        }
      }

      function validateDimensions() {
        const slotId = document.getElementById("adSlotSelect").value;
        const warning = document.getElementById("dimWarning");
        const statusMsg = document.getElementById("statusMessage");
        const resizeOptions = document.getElementById("resizeOptions");
        const generateBtn = document.getElementById("generateBtn");

        if (!slotId || !uploadedImgData) {
          warning.classList.add("hidden");
          generateBtn.disabled = true;
          return;
        }

        const slot = adSlots[slotId];
        const ratioImg = imgNaturalWidth / imgNaturalHeight;
        const isExact =
          imgNaturalWidth === slot.width && imgNaturalHeight === slot.height;
        const isProportional =
          Math.abs(ratioImg - slot.width / slot.height) < 0.01;

        warning.classList.remove("hidden");

        const compatibleSlots = Object.values(adSlots)
          .filter((s) => Math.abs(s.width / s.height - ratioImg) < 0.01)
          .map((s) => s.name);
        const uniqueSlots = [...new Set(compatibleSlots)];

        if (isExact) {
          statusMsg.innerHTML = `<span>‚úÖ Resolusi sesuai. Cocok untuk: <strong>${uniqueSlots.join(", ")}</strong>.</span>`;
          warning.className =
            "mt-3 p-3 bg-green-50 text-green-600 rounded-xl text-[10px] flex flex-col gap-2 font-medium border border-green-100";
          resizeOptions.classList.add("hidden");
        } else if (isProportional) {
          const scale = (imgNaturalWidth / slot.width).toFixed(1);
          statusMsg.innerHTML = `<span>‚ú® High-Res detected (${scale}x). Cocok untuk: <strong>${uniqueSlots.join(", ")}</strong>.</span>`;
          warning.className =
            "mt-3 p-3 bg-blue-50 text-blue-600 rounded-xl text-[10px] flex flex-col gap-3 font-medium border border-blue-100";

          resizeOptions.classList.remove("hidden");
          document.getElementById("btnResize1x").textContent =
            `‚¨áÔ∏è Download 1x (${slot.width}x${slot.height})`;
          document.getElementById("btnResize2x").textContent =
            `‚¨áÔ∏è Download 2x (${slot.width * 2}x${slot.height * 2})`;
        } else {
          statusMsg.innerHTML =
            "<span>‚ö†Ô∏è Resolusi gambar tidak cocok dengan format iklan yang dipilih.</span>";
          warning.className =
            "mt-3 p-3 bg-amber-50 text-amber-600 rounded-xl text-[10px] flex flex-col gap-2 font-medium border border-amber-100";
          resizeOptions.classList.add("hidden");
        }

        generateBtn.disabled = false;
      }

      function resizeAndDownload(multiplier) {
        const slotId = document.getElementById("adSlotSelect").value;
        if (!slotId || !uploadedImgData) return;

        const slot = adSlots[slotId];
        const targetW = slot.width * multiplier;
        const targetH = slot.height * multiplier;

        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");
        canvas.width = targetW;
        canvas.height = targetH;

        const img = new Image();
        img.onload = () => {
          ctx.imageSmoothingEnabled = true;
          ctx.imageSmoothingQuality = "high";
          ctx.drawImage(img, 0, 0, targetW, targetH);

          const resizedData = canvas.toDataURL("image/png");
          const a = document.createElement("a");
          a.href = resizedData;
          a.download = `materi_resized_${multiplier}x_${slotId}.png`;
          a.click();
        };
        img.src = uploadedImgData;
      }

      function toggleTransparency() {
        document
          .getElementById("imageContainer")
          .classList.toggle("bg-checkered");
      }

      function toggleBorder() {
        document
          .getElementById("standaloneImage")
          .classList.toggle("show-border");
      }

      async function generateTemplate() {
        const mainPreview = document.getElementById("mainPreview");
        const slotId = document.getElementById("adSlotSelect").value;
        const slot = adSlots[slotId];
        const logoKey = document.getElementById("logoSelect").value;
        const lpUrl =
          document.getElementById("lpInput").value ||
          "https://www.tribunnews.com";

        mainPreview.classList.add("hidden");
        document.getElementById("placeholderPreview").innerHTML =
          `<div class="spinner"></div><p class="mt-4 text-slate-500 font-medium">Assembling template...</p>`;
        document
          .getElementById("placeholderPreview")
          .classList.remove("hidden");

        try {
          const response = await fetch(slot.template);
          let html = await response.text();

          html = html.replace(
            new RegExp(
              "https://asset-1.tstatic.net/img/logo/tribun/svg/tribunnews.svg",
              "g",
            ),
            logoUrls[logoKey],
          );

          const parser = new DOMParser();
          const doc = parser.parseFromString(html, "text/html");

          doc.querySelectorAll(".ad-slot").forEach((div) => {
            const parentUnderlay = div.closest("#article-underlay");
            const parentLink = div.closest("a");

            if (parentUnderlay) {
              div.style.backgroundImage = `url('${uploadedImgData}')`;
              div.style.backgroundColor = "transparent";
              div.innerHTML = "";

              if (parentLink) {
                parentLink.href = lpUrl;
              }
            } else {
              const imgContent = `<img src="${uploadedImgData}" style="width:100%; height:100%; object-fit:contain; display:block; border:none;">`;

              if (parentLink) {
                div.innerHTML = imgContent;
                parentLink.href = lpUrl;
              } else {
                const wrappedContent = `
            <a href="${lpUrl}" target="_blank" style="display:block; width:100%; height:100%; text-decoration:none;">
              ${imgContent}
            </a>
          `;
                div.innerHTML = wrappedContent;
              }

              div.style.backgroundImage = "none";
              div.style.backgroundColor = "transparent";
            }
          });

          mainPreview.contentDocument.open();
          mainPreview.contentDocument.write(doc.documentElement.outerHTML);
          mainPreview.contentDocument.close();

          const isMobile = ["mobile"].some((k) => slotId.includes(k));
          mainPreview.style.width = isMobile ? "400px" : "100%";

          mainPreview.classList.remove("hidden");
          document.getElementById("placeholderPreview").classList.add("hidden");
          document.getElementById("downloadBtn").disabled = false;
        } catch (err) {
          console.error(err);
        }
      }

      async function downloadBundle() {
        const zip = new JSZip();
        const slotId = document.getElementById("adSlotSelect").value;
        const slot = adSlots[slotId];
        const logoKey = document.getElementById("logoSelect").value;
        const lpUrl =
          document.getElementById("lpInput").value ||
          "https://www.tribunnews.com";

        const response = await fetch(slot.template);
        let tempHtml = await response.text();
        tempHtml = tempHtml.replace(
          new RegExp(
            "https://asset-1.tstatic.net/img/logo/tribun/svg/tribunnews.svg",
            "g",
          ),
          logoUrls[logoKey],
        );

        const doc = new DOMParser().parseFromString(tempHtml, "text/html");
        doc.querySelectorAll(".ad-slot").forEach((div) => {
          div.style.backgroundImage = "none";
          div.style.backgroundColor = "transparent";
          div.innerHTML = `
            <a href="${lpUrl}" target="_blank" style="display:block; width:100%; height:100%; text-decoration:none;">
                <img src="images/ad_materi.png" style="width:100%; height:100%; object-fit:cover; display:block; border:none;">
            </a>
        `;
        });

        zip.file("index.html", doc.documentElement.outerHTML);
        const imgBase64 = uploadedImgData.split(",")[1];
        zip.file("images/ad_materi.png", imgBase64, { base64: true });

        const content = await zip.generateAsync({ type: "blob" });
        const a = document.createElement("a");
        a.href = URL.createObjectURL(content);
        a.download = `image_ad_${slotId}_bundle.zip`;
        a.click();
      }
    </script>
  </body>
</html>
